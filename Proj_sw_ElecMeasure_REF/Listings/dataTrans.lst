C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DATATRANS
OBJECT MODULE PLACED IN .\Output\dataTrans.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE dataTrans\dataTrans.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -..\Proj_sw_ElecMeasure;.\Usr;.\Usr_lib;.\std_Lib;.\hwDriver;.\dataTrans) DEBUG PRINT(.\Listings\dataTrans.lst) OBJECT(.\
                    -Output\dataTrans.obj)

line level    source

   1          #include "dataTrans.h"
   2          
   3          #include "pars_Method.h"
   4          #include "dataManage.h"
   5          #include "wifi_LPT220.h"
   6          #include "HYM8564.h"
   7          #include "HW8012.h"
   8          #include "Relay.h"
   9          #include "Tips.h"
  10          
  11          #include "string.h"
  12          #include "stdio.h"
  13          
  14          #include "USART.h"
  15          #include "soft_uart.h"
  16          #include "eeprom.h"
  17          #include "delay.h"
  18          
  19          //*********************MACµØÖ·Ïà¹Ø±äÁ¿ÒýÓÃÇø*********************/
  20          extern u8 xdata                 MAC_ID[6];
  21          
  22          //*********************¶¨Ê±¶¯×÷Ïß³ÌÏà¹Ø±äÁ¿ÒýÓÃÇø****************/
  23          extern  u8                              swTim_onShoot_FLAG;             //ÆÕÍ¨¿ª¹Ø¶¨Ê±Ò»´ÎÐÔ±êÖ¾¡ª¡ªµÍËÄÎ»±êÊ¶ËÄ¸ö¶¨Ê±Æ÷
  24          extern  bit                             ifTim_sw_running_FLAG;  //ÆÕÍ¨¿ª¹Ø¶¨Ê±ÔËÐÐ±êÖ¾Î»
  25          
  26          extern u8                               ifDelay_sw_running_FLAG;        //ÑÓÊ±¶¯×÷_ÊÇ·ñÔËÐÐ±êÖ¾Î»£¨bit 1ÑÓÊ±¿ª¹ØÔËÐÐÊ¹ÄÜ±êÖ¾£¬bit 0¶¨Ê±¹Ø±Õ
             -ÔËÐÐÊ¹ÄÜ±êÖ¾£©
  27          extern u16                              delayCnt_onoff;
  28          extern u8                               delayPeriod_onoff;
  29          extern bit                              delayUp_act;
  30          extern u16                              delayCnt_closeLoop;
  31          extern u8                               delayPeriod_closeLoop;
  32          
  33          //*********************µçÁ¿¼ì²âÏß³ÌÏà¹Ø±äÁ¿ÒýÓÃÇø****************/
  34          extern  elec_Param      xdata paramElec_Param;  //µç²ÎÊý±äÁ¿
  35          extern  float           xdata elec_Consum;
  36          
  37          //*********************µçÁ¿¼ì²âÏß³ÌÏà¹Ø±äÁ¿ÒýÓÃÇø****************/
  38          extern  bit                     status_Relay;
  39          
  40          /**********************±¾µØÎÄ¼þ±äÁ¿¶¨ÒåÇø************************/
  41          //´®¿Ú½ÓÊÕ³¬Ê±±êÖ¾
  42          bit uartRX_toutFLG                                              = 0;
  43          //´®¿Ú½ÓÊÕ³¬Ê±¼ÆÊý
  44          bit rxTout_count_EN                                     = 0;
  45          u8  rxTout_count                                                = 0;
  46          //´®¿ÚÊý¾Ý»º´æ
  47          u8      datsRcv_length                                          = 0;
  48          uartTout_datsRcv xdata datsRcv_ZIGB     = {{0}, 0};
  49          
  50          //µ±Ç°½ÓÊÕÉÏÎ»»úÄ£Ê½±êÊ¶
  51          dataTrans_obj   dataTrans_objWIFI               = DATATRANS_objFLAG_MOBILE;
  52          
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 2   

  53          //ÉÏÎ»»úÏÂ´ï¿ª¹ØÃüÁî±êÖ¾
  54          switch_Status   swStatus_fromUsr                = swStatus_null;
  55          
  56          //Êý¾Ý°üÏìÓ¦»Ø¸´³¤¶È¡ª¡ªÄ¬ÈÏ¾ÖÓòÍøÊý¾Ý³¤¶È
  57          u8 xdata                repeatTX_Len                    = dataTransLength_objMOBILE;
  58          
  59          //Ô¶¶ËMACID»º´æ
  60          u8      xdata           Dst_MACID_Temp[6]               = {0};
  61          
  62          //ÐÄÌø°üÆæÅ¼±êÖ¾
  63          bit                     heartBeat_Type                  = 0;    //ÆæÅ¼°ü±êÖ¾£¬ÆæÊý°ü1£¬Å¼Êé°ü0
  64          //ÐÄÌø°üÖÜÆÚ¼ÆÊýÖµ
  65          u16     xdata           heartBeat_Cnt                   = 0;
  66          //ÐÄÌø°ü¼ÆÊýÖÜÆÚ
  67          const   u32     heartBeat_Period                = 8000;         //ÐÄÌø°üÖÜÆÚÉèÖÃºÁÃëÏµÊýÖµ * 50us£¨¶¨Ê±Æ÷ÄÚ¼ÆÊý£©
  68          
  69          /*--------------------------------------------------------------*/
  70          void uartObjWIFI_Init(void){
  71   1              
  72   1              EA = 0;
  73   1      
  74   1              PS = 1;
  75   1              SCON = (SCON & 0x3f) | UART_8bit_BRTx;
  76   1      
  77   1      {
  78   2              u32 j = (MAIN_Fosc / 4) / BAUD_WIFI;    //°´1T¼ÆËã
  79   2                      j = 65536UL - j;
  80   2              
  81   2              TH2 = (u8)(j>>8);
  82   2              TL2 = (u8)j;
  83   2      }
  84   1              AUXR &= ~(1<<4);        //Timer stop
  85   1              AUXR |= 0x01;           //S1 BRT Use Timer2;
  86   1              AUXR &= ~(1<<3);        //Timer2 set As Timer
  87   1              AUXR |=  (1<<2);        //Timer2 set as 1T mode
  88   1      
  89   1              IE2  &= ~(1<<2);        //½ûÖ¹ÖÐ¶Ï
  90   1              AUXR &= ~(1<<3);        //¶¨Ê±
  91   1              AUXR |=  (1<<4);        //Timer run enable
  92   1      
  93   1              ES        = 1;
  94   1              REN   = 1;
  95   1              P_SW1 = (P_SW1 & 0x3f) | (UART1_SW_P30_P31 & 0xc0);
  96   1              
  97   1              memset(TX1_Buffer, 0, sizeof(char) * COM_TX1_Lenth);
  98   1      
  99   1              EA = 1;
 100   1              
 101   1              PrintString1("i'm UART1 for wifi data translate !!!");
 102   1      }
 103          
 104          /*----------------------------
 105          ·¢ËÍ´®¿ÚÊý¾Ý
 106          ----------------------------*/
 107          void uartObjWIFI_Send_Byte(u8 dat)      //´®¿Ú1
 108          {
 109   1              TX1_write2buff(dat);
 110   1      }
 111          
 112          void uartObjWIFI_Send_String(char *s,unsigned char ucLength){    //´®¿Ú1
 113   1              
 114   1              uart1_datsSend(s, ucLength);
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 3   

 115   1      }
 116          
 117          void rxBuff_WIFI_Clr(void){
 118   1      
 119   1              memset(rxBuff_WIFI, 0xff, sizeof(char) * COM_RX1_Lenth);
 120   1              COM1.RX_Cnt = 0;
 121   1      }
 122          
 123          /********************* ×Ô¶¨ÒåÐ£Ñé*****************************/
 124          unsigned char frame_Check(unsigned char frame_temp[], u8 check_num){
 125   1        
 126   1              unsigned char loop              = 0;
 127   1              unsigned char val_Check = 0;
 128   1              
 129   1              for(loop = 0; loop < check_num; loop ++){
 130   2              
 131   2                      val_Check += frame_temp[loop];
 132   2              }
 133   1              
 134   1              val_Check  = ~val_Check;
 135   1              val_Check ^= 0xa7;
 136   1              
 137   1              return val_Check;
 138   1      }
 139          
 140          /*´ËÊý¾Ý·â×°±ØÐëÔÚÊý¾Ý°ü·¢ËÍÇ°×îºóµ÷ÓÃ£¬×Ô¶¯¸ù¾ÝÉÏ´ÎÊý¾Ý´«ÊäÊ±µÄ¶ÔÏó½øÐÐÊý¾Ý·â×°*///±ÜÃâÐ£Ñé±»ÌáÇ°¶ø³ö´í
 141          void dtasTX_loadBasic_AUTO(u8 dats_Tx[45],              //·¢ËÍ°üÊý¾Ý»º´æ»ù±¾ÐÅÏ¢Ìî×°
 142                                                             u8 frame_Type,
 143                                                             u8 frame_CMD,
 144                                                             bit ifSpecial_CMD){  
 145   1                                                        
 146   1              switch(repeatTX_Len){
 147   2              
 148   2                      /*·þÎñÆ÷Êý¾Ý°üÌî×°*///45×Ö½Ú
 149   2                      case dataTransLength_objSERVER:{
 150   3                              
 151   3                              u8 xdata datsTemp[32] = {0};
 152   3                      
 153   3                              dats_Tx[0]      = FRAME_HEAD_SERVER;
 154   3                              
 155   3                              memcpy(&datsTemp[0], &dats_Tx[1], 32);
 156   3                              memcpy(&dats_Tx[13], &datsTemp[0], 32); //Ö¡Í·ºóÀ­¿ª¿Õ³ö12¸ö×Ö½Ú
 157   3                              memcpy(&dats_Tx[1],  &Dst_MACID_Temp[0], 6);    //Ô¶¶ËMACIDÌî³ä
 158   3                              memcpy(&dats_Tx[8],  &MAC_ID[1], 5);    /*dats_Tx[7] ÔÝÊ±Ìî0*///Ô¶¶ËMACIDÌî³ä
 159   3                              
 160   3                              dats_Tx[1 + 12] = dataTransLength_objSERVER;
 161   3                              dats_Tx[2 + 12] = frame_Type;
 162   3                              dats_Tx[3 + 12] = frame_CMD;
 163   3                              
 164   3                              if(!ifSpecial_CMD)dats_Tx[10 + 12] = SWITCH_TYPE_FP;    //¿ª¹ØÀàÐÍÌî³ä
 165   3                              
 166   3                              memcpy(&dats_Tx[5 + 12], &MAC_ID[1], 5);        //MACÌî³ä
 167   3                                                                        
 168   3                              dats_Tx[4 + 12] = frame_Check(&dats_Tx[5 + 12], 28);    
 169   3                              
 170   3                      }break;
 171   2                      
 172   2                      /*¾ÖÓòÍøÊý¾Ý°üÌî×°*///33×Ö½Ú
 173   2                      case dataTransLength_objMOBILE:{
 174   3                      
 175   3                              dats_Tx[0]      = FRAME_HEAD_MOBILE;
 176   3                              
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 4   

 177   3                              dats_Tx[1]      = dataTransLength_objMOBILE;
 178   3                              dats_Tx[2]      = frame_Type;
 179   3                              dats_Tx[3]      = frame_CMD;
 180   3                              
 181   3                              if(!ifSpecial_CMD)dats_Tx[10] = SWITCH_TYPE_FP; //¿ª¹ØÀàÐÍÌî³ä
 182   3                              
 183   3                              memcpy(&dats_Tx[5], &MAC_ID[1], 5);     //MACÌî³ä
 184   3                                                                        
 185   3                              dats_Tx[4]      = frame_Check(&dats_Tx[5], 28);
 186   3                      }break;
 187   2                      
 188   2                      default:break;
 189   2              }       
 190   1      }
 191                                                             
 192          /*´ËÊý¾Ý·â×°±ØÐëÔÚÊý¾Ý°ü·¢ËÍÇ°×îºóµ÷ÓÃ£¬×Ô¶¨Òå¶ÔÏó½øÐÐÊý¾Ý·â×°*///±ÜÃâÐ£Ñé±»ÌáÇ°¶ø³ö´í
 193          void dtasTX_loadBasic_CUST(dataTrans_obj obj_custom,    //·¢ËÍ°üÊý¾Ý»º´æ»ù±¾ÐÅÏ¢Ìî×°
 194                                                             u8 dats_Tx[45],              
 195                                                             u8 frame_Type,
 196                                                             u8 frame_CMD,
 197                                                             bit ifSpecial_CMD){  
 198   1                                                        
 199   1              switch(obj_custom){
 200   2              
 201   2                      /*·þÎñÆ÷Êý¾Ý°üÌî×°*///45×Ö½Ú
 202   2                      case DATATRANS_objFLAG_SERVER:{
 203   3                              
 204   3                              u8 xdata datsTemp[32] = {0};
 205   3                      
 206   3                              dats_Tx[0]      = FRAME_HEAD_SERVER;
 207   3                              
 208   3                              memcpy(&datsTemp[0], &dats_Tx[1], 32);
 209   3                              memcpy(&dats_Tx[13], &datsTemp[0], 32); //Ö¡Í·ºóÀ­¿ª¿Õ³ö12¸ö×Ö½Ú
 210   3                              memcpy(&dats_Tx[1],  &Dst_MACID_Temp[0], 6);    //Ô¶¶ËMACIDÌî³ä
 211   3                              memcpy(&dats_Tx[8],  &MAC_ID[1], 5);    /*dats_Tx[7] ÔÝÊ±Ìî0*///Ô¶¶ËMACIDÌî³ä
 212   3                              
 213   3                              dats_Tx[1 + 12] = dataTransLength_objSERVER;
 214   3                              dats_Tx[2 + 12] = frame_Type;
 215   3                              dats_Tx[3 + 12] = frame_CMD;
 216   3                              
 217   3                              if(!ifSpecial_CMD)dats_Tx[10 + 12] = SWITCH_TYPE_FP;    //¿ª¹ØÀàÐÍÌî³ä
 218   3                              
 219   3                              memcpy(&dats_Tx[5 + 12], &MAC_ID[1], 5);        //MACÌî³ä
 220   3                                                                        
 221   3                              dats_Tx[4 + 12] = frame_Check(&dats_Tx[5 + 12], 28);    
 222   3                              
 223   3                      }break;
 224   2                      
 225   2                      /*¾ÖÓòÍøÊý¾Ý°üÌî×°*///33×Ö½Ú    --³ýÁË45¶¼ÊÇ33Ìî×°
 226   2                      case DATATRANS_objFLAG_MOBILE:
 227   2                      
 228   2                      default:{
 229   3                      
 230   3                              dats_Tx[0]      = FRAME_HEAD_MOBILE;
 231   3                              
 232   3                              dats_Tx[1]      = dataTransLength_objMOBILE;
 233   3                              dats_Tx[2]      = frame_Type;
 234   3                              dats_Tx[3]      = frame_CMD;
 235   3                              
 236   3                              if(!ifSpecial_CMD)dats_Tx[10] = SWITCH_TYPE_FP; //¿ª¹ØÀàÐÍÌî³ä
 237   3                              
 238   3                              memcpy(&dats_Tx[5], &MAC_ID[1], 5);     //MACÌî³ä
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 5   

 239   3                                                                        
 240   3                              dats_Tx[4]      = frame_Check(&dats_Tx[5], 28);
 241   3                      }break;
 242   2              }       
 243   1      }
 244          
 245          /********************* UART1(WIIF)ÖÐ¶Ïº¯Êý_×Ô¶¨ÒåÖØ¹¹************************/
 246          void UART1_Rountine (void) interrupt UART1_VECTOR
 247          {
 248   1              
 249   1              EA = 0;
 250   1              
 251   1              if(RI)
 252   1              {
 253   2                      RI = 0;
 254   2                      if(COM1.B_RX_OK == 0)
 255   2                      {               
 256   3                              if(!rxTout_count_EN){
 257   4                              
 258   4                                      rxTout_count_EN = 1;
 259   4                                      rxTout_count    = 0;
 260   4                                      datsRcv_length  = 0;
 261   4                                      
 262   4                                      memset(RX1_Buffer, 0xff, sizeof(char) * COM_RX1_Lenth);
 263   4                              }
 264   3                              
 265   3                              RX1_Buffer[datsRcv_length ++] = SBUF;
 266   3                              rxTout_count = 0;
 267   3                      }
 268   2              }
 269   1      
 270   1              if(TI)
 271   1              {
 272   2                      TI = 0;
 273   2                      if(COM1.TX_read != COM1.TX_write)
 274   2                      {
 275   3                              SBUF = TX1_Buffer[COM1.TX_read];
 276   3                              if(++COM1.TX_read >= COM_TX1_Lenth)             COM1.TX_read = 0;
 277   3                      }
 278   2                      else    COM1.B_TX_busy = 0;
 279   2              }
 280   1              
 281   1              EA = 1;
 282   1      }
 283          
 284          /***********Ö÷¶¯Êý¾Ý¼ì²â¼ì²âÁ¢Âí¸üÐÂÐÄÌø°ü**************/
 285          void thread_LocalStaus_Release(void){
 286   1      
 287   1              static bit                              Local_ifTim_sw_running_FLAG                     = 0;
 288   1              static bit                              Local_status_Relay                                      = false;
 289   1              static bit                              Local_deviceLock_flag                           = false;
 290   1              static u8                               Local_ifDelay_sw_running_FLAG           = 0;
 291   1              
 292   1              if((Local_ifTim_sw_running_FLAG                 != ifTim_sw_running_FLAG) ||
 293   1                 (Local_status_Relay                                  != status_Relay) ||
 294   1                 (Local_deviceLock_flag                               != deviceLock_flag) ||
 295   1                 (Local_ifDelay_sw_running_FLAG               != ifDelay_sw_running_FLAG)
 296   1              ){
 297   2                      
 298   2                      heartBeat_Cnt   = heartBeat_Period - 100;       //Á¢¼´¸üÐÂÅ¼ÊýÐÄÌø¡ª¡ª×´Ì¬°ü£¬µÈ100ms£¬·ÀÖ¹Ä£¿éÕ³°ü
 299   2                      heartBeat_Type  = 0;    //Å¼Êý°ü
 300   2                              
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 6   

 301   2                      Local_ifTim_sw_running_FLAG             = ifTim_sw_running_FLAG;
 302   2                      Local_status_Relay                                      = status_Relay;
 303   2                      Local_deviceLock_flag                           = deviceLock_flag;
 304   2                      Local_ifDelay_sw_running_FLAG           = ifDelay_sw_running_FLAG;
 305   2              }
 306   1      }
 307          
 308          /********************* Êý¾Ý´«Êä¼°½âÎö************************/
 309          void thread_dataTrans(void){
 310   1              
 311   1              static u8 timeZone_Hour         = 0;
 312   1              static u8 timeZone_Minute       = 0;
 313   1              
 314   1              unsigned char xdata repeatTX_buff[45]   = {0};
 315   1              unsigned char xdata rxBuff_WIFI_temp[45]= {0};
 316   1                      
 317   1              unsigned char frameLength                               = 0;
 318   1      
 319   1              bit datsQualified_FLG                                   = 0;    
 320   1              bit Parsing_EN                                                  = 0;
 321   1              
 322   1              u8 xdata heartBeat_Pack[14]                     = {0};  
 323   1              
 324   1              static u8 elec_Consum_moment                    = 0;    //ÓÃµçÁ¿¶ÔÓ¦Ê±¶Î±êÖ¾£¬µçÁ¿Ö»ÊÇÃ¿Ð¡Ê±µÄÓÃµçÁ¿
 325   1              
 326   1              /*********************************Êý¾Ý°ü²É¼¯**********************************/
 327   1              if(uartRX_toutFLG){ //³¬Ê±¶ÏÖ¡
 328   2              
 329   2                      uartRX_toutFLG = 0;
 330   2                      
 331   2                      memset(rxBuff_WIFI_temp, 0, 45 * sizeof(u8));
 332   2                      
 333   2                      if((datsRcv_ZIGB.rcvDats[0] == FRAME_HEAD_SERVER) && 
 334   2                         (datsRcv_ZIGB.rcvDats[13] == dataTransLength_objSERVER) &&
 335   2                         (datsRcv_ZIGB.rcvDats[14] == FRAME_TYPE_MtoS_CMD) &&
 336   2                         (datsRcv_ZIGB.rcvDatsLen >= dataTransLength_objSERVER)){ /*ÉÏÎ»»ú·¢ÁË¸ö×Ö½Ú*/
 337   3                              
 338   3                              memcpy(&Dst_MACID_Temp[0], &datsRcv_ZIGB.rcvDats[7], 6);  //Ô¶¶ËMACIDÔÝ´æ       
 339   3                              rxBuff_WIFI_temp[0] = datsRcv_ZIGB.rcvDats[0]; //Ö¡Í·¸³Öµ
 340   3                              memcpy(&rxBuff_WIFI_temp[1], &datsRcv_ZIGB.rcvDats[13], 32);    //Êý¾Ý¼ÓÔØ£¬Ö¡¶ÔÆë£¬¶ÔÆë³É33×Ö½Ú
 341   3                              
 342   3                              //ÏìÓ¦»Ø¸´¶ÔÏóÊôÐÔ¸üÐÂ  
 343   3                              dataTrans_objWIFI = DATATRANS_objFLAG_SERVER;
 344   3                              repeatTX_Len      = dataTransLength_objSERVER;
 345   3                              
 346   3                              frameLength = dataTransLength_objSERVER;
 347   3                              datsQualified_FLG = 1;
 348   3                                      
 349   3                      }else
 350   2                      if((datsRcv_ZIGB.rcvDats[0] == FRAME_HEAD_MOBILE) && 
 351   2                         (datsRcv_ZIGB.rcvDats[1] == dataTransLength_objMOBILE) &&
 352   2                         (datsRcv_ZIGB.rcvDats[2] == FRAME_TYPE_MtoS_CMD) &&
 353   2                         (datsRcv_ZIGB.rcvDatsLen == dataTransLength_objMOBILE)){
 354   3                      
 355   3                              memcpy(rxBuff_WIFI_temp, datsRcv_ZIGB.rcvDats, dataTransLength_objMOBILE);      //Êý¾Ý¼ÓÔØ
 356   3                              
 357   3                              //ÏìÓ¦»Ø¸´¶ÔÏóÊôÐÔ¸üÐÂ  
 358   3                              dataTrans_objWIFI = DATATRANS_objFLAG_MOBILE;
 359   3                              repeatTX_Len      = dataTransLength_objMOBILE;
 360   3                                      
 361   3                              frameLength = dataTransLength_objMOBILE;
 362   3                              datsQualified_FLG = 1;
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 7   

 363   3                                      
 364   3                      }else
 365   2                      if((datsRcv_ZIGB.rcvDats[0] == FRAME_HEAD_HEARTBEAT) && 
 366   2                         (datsRcv_ZIGB.rcvDats[1] == dataHeartBeatLength_objSERVER) &&
 367   2                         (datsRcv_ZIGB.rcvDatsLen == 14)){ /*·þÎñÆ÷»ØµÄ»¹ÊÇ14×Ö½Ú*///µ«ÊÇÖ¡³¤Îª20£¬ÎÒ·¢µÄ20×Ö½Ú£¬·þÎñÆ÷ÒÀÈ»»Ø1
             -4×Ö½Ú
 368   3                              
 369   3                              memcpy(rxBuff_WIFI_temp, datsRcv_ZIGB.rcvDats, 14);     //Êý¾Ý¼ÓÔØ
 370   3                              
 371   3                              //ÏìÓ¦»Ø¸´¶ÔÏóÊôÐÔ¸üÐÂ  --²»½øÐÐrepeatTX_Len¸üÐÂ£¡£¡£¡
 372   3                              dataTrans_objWIFI = HEARTBEAT_objFLAG_SERVER;
 373   3                                 
 374   3                              frameLength = dataHeartBeatLength_objSERVER;
 375   3                              datsQualified_FLG = 1;
 376   3                                 
 377   3                      }else{
 378   3                      
 379   3                              dataTrans_objWIFI = dataTrans_obj_NULL;
 380   3                              datsQualified_FLG = 0;
 381   3                      }
 382   2              }
 383   1              
 384   1              /*********************************Êý¾Ý°üÀàÐÍÕç±ð**********************************/
 385   1              if(datsQualified_FLG){
 386   2                      
 387   2                      bit frameCodeCheck_PASS = 0; //Ð£ÑéÂë¼ì²éÍ¨¹ý±êÖ¾
 388   2                      bit frameMacCheck_PASS  = 0; //macµØÖ·´ý¼ì²éÍ¨¹ý±êÖ¾
 389   2                      
 390   2                      datsQualified_FLG = 0;
 391   2              
 392   2                      switch(frameLength){
 393   3                      
 394   3                              case dataTransLength_objSERVER:
 395   3                              case dataTransLength_objMOBILE:{
 396   4                              
 397   4                                      if(rxBuff_WIFI_temp[4] == frame_Check(&rxBuff_WIFI_temp[5], 28))frameCodeCheck_PASS = 1; //Ð£ÑéÂë¼ì²é
 398   4                                      if(!memcmp(&rxBuff_WIFI_temp[5], &MAC_ID[1], 5))frameMacCheck_PASS  = 1; //macµØÖ·¼ì²é
 399   4                                      
 400   4                                      if(rxBuff_WIFI_temp[3] == FRAME_MtoSCMD_cmdCfg_swTim){ //²»ÓÃ½øÐÐÐ£ÑéÂë¼ì²éµÄÖ¸Áî
 401   5                                      
 402   5                                              frameCodeCheck_PASS = 1;        
 403   5                                              
 404   5                                      }
 405   4                                      if(rxBuff_WIFI_temp[3] == FRAME_MtoSCMD_cmdConfigSearch){ //²»ÓÃ½øÐÐmacµØÖ·¼ì²éµÄÖ¸Áî
 406   5                                      
 407   5                                              frameMacCheck_PASS = 1; 
 408   5                                              
 409   5                                      }
 410   4                                      
 411   4                                      if(frameMacCheck_PASS & frameMacCheck_PASS){ //Ö¸ÁîÑéÖ¤
 412   5                                              
 413   5                                              Parsing_EN = 1; 
 414   5                                              
 415   5                                      }else{
 416   5                                      
 417   5      //                                      if(!frameMacCheck_PASS)uartObjWIFI_Send_String("fuck mac", 8);
 418   5      //                                      if(!frameMacCheck_PASS)uartObjWIFI_Send_String("fuck code", 9);rxBuff_WIFI_temp
 419   5      //                                      uartObjWIFI_Send_String(rxBuff_WIFI_temp, 33);
 420   5                                      }
 421   4                                      
 422   4                              }break;
 423   3                              
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 8   

 424   3                              case dataHeartBeatLength_objSERVER:{
 425   4                              
 426   4                                      if(!memcmp(&rxBuff_WIFI_temp[3], &MAC_ID[1], 5)){       //MACµØÖ·±¾µØ±È¶Ô
 427   5                                              
 428   5                                              Parsing_EN = 1; 
 429   5                                      }
 430   4                                      
 431   4                              }break;
 432   3                              
 433   3                              default:{
 434   4                      
 435   4                                      Parsing_EN = 0; 
 436   4                                      
 437   4                              }break;
 438   3                      }
 439   2              }
 440   1              
 441   1              /*********************************Êý¾Ý°ü¿ªÊ¼½âÎöÏìÓ¦**********************************/ 
 442   1              if(Parsing_EN){ //¿ªÊ¼½âÎö
 443   2                      
 444   2                      Parsing_EN = 0;
 445   2                      
 446   2                      switch(dataTrans_objWIFI){
 447   3                      
 448   3                              //·þÎñÆ÷
 449   3                              case DATATRANS_objFLAG_SERVER:
 450   3                              //¾ÖÓòÍø
 451   3                              case DATATRANS_objFLAG_MOBILE:{
 452   4                                      
 453   4                                              bit specialCmd_FLAG = 0;        /*ÌØÊâÊý¾Ý·â×°±êÖ¾*///Êý¾Ý1ÊÇ·ñÕ¼ÓÃ£¨Ô­Îª¿ª¹ØÀàÐÍ£©
 454   4                                              bit respond_FLAG        = 1;    /*ÊÇ·ñÏàÓ¦»Ø¸´±êÖ¾*///Êý¾Ý½ÓÊÕºóÊÇ·ñÖ÷¶¯»Ø¸´ÏìÓ¦
 455   4                                      
 456   4                                              u8 cmdParing_Temp = rxBuff_WIFI_temp[3];
 457   4                                      
 458   4                                              memset(repeatTX_buff, 0, sizeof(u8) * 45);
 459   4      
 460   4                                              switch(cmdParing_Temp){         //ÃüÁî½âÎö¼°Ê¶±ð
 461   5      
 462   5                                                      /*¿ØÖÆÖ¸Áî*/
 463   5                                                      case FRAME_MtoSCMD_cmdControl:{         
 464   6                                                              
 465   6                                                              switch(rxBuff_WIFI_temp[11]){
 466   7                                                              
 467   7                                                                      case 0x00:{             //¿ª¹Ø_¿ª
 468   8                                                                      
 469   8                                                                              swStatus_fromUsr = swStatus_off;
 470   8                                                                              
 471   8                                                                      }break;
 472   7                                                                              
 473   7                                                                      case 0x01:{             //¿ª¹Ø_¹Ø
 474   8                                                                      
 475   8                                                                              swStatus_fromUsr = swStatus_on;
 476   8      
 477   8                                                                      }break;
 478   7                                                                      
 479   7                                                                      default:break;
 480   7                                                              }
 481   6                                                              
 482   6                                                              repeatTX_buff[11]       = rxBuff_WIFI_temp[11];         //¿ª¹Ø×´Ì¬¸üÐÂÌî³ä
 483   6                                                              
 484   6                                                      }break;
 485   5      
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 9   

 486   5                                                      /*ÅäÖÃËÑË÷Ö¸Áî*/
 487   5                                                      case FRAME_MtoSCMD_cmdConfigSearch:{    
 488   6                                                              
 489   6                                                              u8 deviceLock_IF = 0;
 490   6                                                                                              
 491   6                                                              EEPROM_read_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 492   6                                                              
 493   6                                                              //ÉÏËø¼ì²â
 494   6                                                              if(!deviceLock_IF){     
 495   7                                                                      
 496   7                                                                      u8 xdata serverIP_temp[4] = {0};
 497   7                                                                      memcpy(&serverIP_temp[0], &rxBuff_WIFI_temp[6], 4);
 498   7                                                              
 499   7                                                                      //·þÎñÆ÷µØÖ·Í¬²½
 500   7                                                                      if(WIFI_serverUDP_CHG(serverIP_temp)){
 501   8                                                                              
 502   8      
 503   8                                                                      }else{
 504   8                                                                      
 505   8                                                                      }
 506   7      
 507   7                                                                      //Ê±¼äÐÅÏ¢Í¬²½
 508   7                                                                      timeZone_Hour   = rxBuff_WIFI_temp[12];         //Ê±Çø¸üÐÂ
 509   7                                                                      timeZone_Minute = rxBuff_WIFI_temp[13];
 510   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_timeZone_H, &timeZone_Hour, 1);
 511   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_timeZone_M, &timeZone_Minute, 1);
 512   7                                                                      
 513   7                                                              }else{
 514   7                                                              
 515   7                                                                      respond_FLAG = 0;
 516   7                                                              }
 517   6                                                              
 518   6                                                      }break;
 519   5                                                      
 520   5                                                      /*²éÑ¯µÇÂ¼Ö¸Áî*/
 521   5                                                      case FRAME_MtoSCMD_cmdQuery:{   
 522   6                                                              
 523   6                                                              u8 deviceLock_IF = 0;
 524   6                                                              
 525   6                                                              EEPROM_read_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 526   6      
 527   6                                                              if(deviceLock_IF){
 528   7                                                                      
 529   7                                                                      
 530   7                                                              }else{
 531   7                                                              
 532   7      
 533   7                                                              }
 534   6                                                              
 535   6                                                      }break;
 536   5                                                      
 537   5                                                      case FRAME_MtoSCMD_cmdCfg_swTim:{       /*ÆÕÍ¨¿ª¹Ø¶¨Ê±ÅäÖÃÖ¸Áî*/
 538   6                                                              
 539   6                                                              u8 loop = 0;
 540   6                                                              
 541   6                                                              //Ð£Ê±
 542   6                                                              stt_Time datsTime_temp = {0};
 543   6                                                              
 544   6                                                              datsTime_temp.time_Year         = rxBuff_WIFI_temp[26];
 545   6                                                              datsTime_temp.time_Month        = rxBuff_WIFI_temp[27];
 546   6                                                              datsTime_temp.time_Day          = rxBuff_WIFI_temp[28];
 547   6                                                              datsTime_temp.time_Hour         = rxBuff_WIFI_temp[29];
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 10  

 548   6                                                              elec_Consum_moment                      = datsTime_temp.time_Hour;
 549   6                                                              datsTime_temp.time_Minute       = rxBuff_WIFI_temp[30];
 550   6                                                              datsTime_temp.time_Week         = rxBuff_WIFI_temp[31];
 551   6                                                              
 552   6                                                              timeSet(datsTime_temp);
 553   6                                                              
 554   6                                                              //¶¨Ê±Êý¾Ý´¦Àí¼°¸üÐÂ,·ÖÀà´¦Àí
 555   6                                                              switch(rxBuff_WIFI_temp[13]){
 556   7                                                              
 557   7                                                                      case cmdConfigTim_normalSwConfig:{      /*ÆÕÍ¨¶¨Ê±*/
 558   8                                                                              
 559   8                                                                              for(loop = 0; loop < 4; loop ++){
 560   9                                                                              
 561   9                                                                                      if(rxBuff_WIFI_temp[14 + loop * 3] == 0x80){    /*Ò»´ÎÐÔ¶¨Ê±ÅÐ¶Ï*///ÖÜÕ¼Î»Îª¿Õ£¬¶ø¶¨Ê±Æ÷±»´ò¿ª£¬ËµÃ
             -÷ÊÇÒ»´ÎÐÔ
 562  10                                                                                      
 563  10                                                                                              swTim_onShoot_FLAG                              |= (1 << loop); //Ò»´ÎÐÔ¶¨Ê±±êÖ¾¿ªÆô
 564  10                                                                                              rxBuff_WIFI_temp[14 + loop * 3] |= (1 << (rxBuff_WIFI_temp[31] - 1)); //Ç¿ÐÐ½øÐÐµ±Ç°ÖÜÕ¼Î»£¬µ±´
             -ÎÖ´ÐÐÍê±ÏºóÇå³ý
 565  10                                                                                      }
 566   9                                                                              }
 567   8                                                                              coverEEPROM_write_n(EEPROM_ADDR_swTimeTab, &rxBuff_WIFI_temp[14], 12);  //¶¨Ê±±í
 568   8      
 569   8                                                                      }break;
 570   7                                                                      
 571   7                                                                      case cmdConfigTim_onoffDelaySwConfig:{  /*¿ª¹ØÑÓÊ±*/
 572   8                                                                      
 573   8                                                                              if(rxBuff_WIFI_temp[14]){
 574   9                                                                              
 575   9                                                                                      ifDelay_sw_running_FLAG |= (1 << 1);
 576   9                                                                                      delayPeriod_onoff               = rxBuff_WIFI_temp[14];
 577   9                                                                                      
 578   9      //                                                                              if(rxBuff_WIFI_temp[15] == 2)delayUp_act = 1; //2ÎªÑÓÊ±¿ª£¬1ÎªÑÓÊ±¹Ø
 579   9      //                                                                              else delayUp_act = 0;
 580   9                                                                                      
 581   9                                                                                      delayUp_act                             = rxBuff_WIFI_temp[15];
 582   9                                                                                      
 583   9                                                                                      delayCnt_onoff                  = 0;
 584   9                                                                                      
 585   9                                                                              }else{
 586   9                                                                              
 587   9                                                                                      ifDelay_sw_running_FLAG &= ~(1 << 1); //ÎÞÐèµôµç±£´æ
 588   9                                                                                      delayPeriod_onoff               = 0;
 589   9                                                                                      delayCnt_onoff                  = 0;
 590   9                                                                              }
 591   8                                                                              
 592   8                                                                      }break;
 593   7                                                                      
 594   7                                                                      case cmdConfigTim_closeLoopSwConfig:{   /*×Ô¶¯Ñ­»·¹Ø±Õ*/
 595   8                                                                      
 596   8                                                                              if(rxBuff_WIFI_temp[14]){
 597   9                                                                              
 598   9                                                                                      ifDelay_sw_running_FLAG |= (1 << 0);
 599   9                                                                                      delayPeriod_closeLoop   = rxBuff_WIFI_temp[14];
 600   9                                                                                      delayCnt_closeLoop              = 0;
 601   9                                                                              }else{
 602   9                                                                              
 603   9                                                                                      ifDelay_sw_running_FLAG &= ~(1 << 0); //ÐèÒªµôµç±£´æ
 604   9                                                                                      delayPeriod_closeLoop   = 0;
 605   9                                                                                      delayCnt_closeLoop              = 0;
 606   9                                                                              }
 607   8                                                                              
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 11  

 608   8                                                                              coverEEPROM_write_n(EEPROM_ADDR_swDelayFLAG, &ifDelay_sw_running_FLAG, 1);
 609   8                                                                              coverEEPROM_write_n(EEPROM_ADDR_periodCloseLoop, &delayPeriod_closeLoop, 1);
 610   8                                                                              
 611   8                                                                      }break;                                                         
 612   7                                                                      
 613   7                                                                      default:break;
 614   7                                                              }
 615   6                                                              
 616   6                                                              //Êý¾ÝÏìÓ¦¼°»Ø¸´
 617   6                                                              repeatTX_buff[12]       = rxBuff_WIFI_temp[12];
 618   6                                                              repeatTX_buff[13]       = rxBuff_WIFI_temp[13];
 619   6      
 620   6                                                      }break;
 621   5                                                      
 622   5                                                      /*ÅäÖÃ»¥¿ØÖ¸Áî*/
 623   5                                                      case FRAME_MtoSCMD_cmdInterface:{       
 624   6                                                      
 625   6                                                              
 626   6                                                              
 627   6                                                      }break;
 628   5                                                      
 629   5                                                      /*¿ª¹Ø¸´Î»Ö¸Áî*/
 630   5                                                      case FRAME_MtoSCMD_cmdReset:{           
 631   6                                                      
 632   6                                                              
 633   6                                                              
 634   6                                                      }break;
 635   5                                                      
 636   5                                                      /*Éè±¸Ëø¶¨Ö¸Áî¡ª¡ªÉè±¸ÐÅÏ¢ÏìÓ¦Ê§ÄÜ*/
 637   5                                                      case FRAME_MtoSCMD_cmdLockON:{          
 638   6                                                              
 639   6                                                              //Êý¾Ý´¦Àí¼°¶¯×÷ÏìÓ¦
 640   6                                                              {
 641   7                                                                      u8 deviceLock_IF = 1;
 642   7                                                                      
 643   7                                                                      deviceLock_flag  = 1;
 644   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 645   7                                                              }                                                       
 646   6                                                      }break;
 647   5                                                      
 648   5                                                      /*Éè±¸½âËøÖ¸Áî¡ª¡ªÉè±¸ÐÅÏ¢ÏìÓ¦Ê¹ÄÜ*/
 649   5                                                      case FRAME_MtoSCMD_cmdLockOFF:{         
 650   6                                                              
 651   6                                                              //Êý¾Ý´¦Àí¼°¶¯×÷ÏìÓ¦
 652   6                                                              {
 653   7                                                                      u8 deviceLock_IF = 0;
 654   7                                                                      
 655   7                                                                      deviceLock_flag  = 0;
 656   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 657   7                                                              }                                               
 658   6                                                      }break;
 659   5                                                      
 660   5                                                      /*ÆÕÍ¨¿ª¹Ø¶¨Ê±ÅäÖÃ²éÑ¯Ö¸Áî*/
 661   5                                                      case FRAME_MtoSCMD_cmdswTimQuery:{      
 662   6                                                              
 663   6                                                              repeatTX_buff[12]       = rxBuff_WIFI_temp[12];
 664   6                                                              repeatTX_buff[13]       = rxBuff_WIFI_temp[13];
 665   6                                                              
 666   6                                                              //·ÖÀà»Ø¸´
 667   6                                                              switch(rxBuff_WIFI_temp[13]){
 668   7                                                              
 669   7                                                                      case 0: /*ÉÏÎ»»úÔÚ¶¨Ê±µÄÊ±ºò¸ø0£¬´ýÐ­ÉÌ*/
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 12  

 670   7                                                                      case cmdConfigTim_normalSwConfig:{
 671   8                                                                      
 672   8                                                                              u8 loop = 0;
 673   8                                                                      
 674   8                                                                              //Êý¾ÝÏìÓ¦¼°»Ø¸´
 675   8                                                                              EEPROM_read_n(EEPROM_ADDR_swTimeTab, &repeatTX_buff[14], 12);   //¶¨Ê±±í»Ø¸´Ìî×°
 676   8                                                                              
 677   8                                                                              //»Ø¸´Êý¾Ý¶þ´Î´¦Àí£¨Õë¶ÔÒ»´ÎÐÔ¶¨Ê±Êý¾Ý£©
 678   8                                                                              for(loop = 0; loop < 4; loop ++){
 679   9                                                                              
 680   9                                                                                      if(swTim_onShoot_FLAG & (1 << loop)){
 681  10                                                                                              
 682  10                                                                                              repeatTX_buff[14 + loop * 3] &= 0x80;
 683  10                                                                                      }
 684   9                                                                              }
 685   8                                                                              
 686   8                                                                              specialCmd_FLAG = 1;
 687   8                                                                              
 688   8                                                                      }break;
 689   7                                                                      
 690   7                                                                      case cmdConfigTim_onoffDelaySwConfig:{
 691   8                                                                      
 692   8                                                                              if(!delayCnt_onoff)repeatTX_buff[14] = 0;
 693   8                                                                              else repeatTX_buff[14] = delayPeriod_onoff - (u8)(delayCnt_onoff / 60);
 694   8                                                                              repeatTX_buff[15] = delayUp_act;
 695   8      //                                                                      if(delayUp_act)repeatTX_buff[15] = 2;
 696   8      //                                                                      else repeatTX_buff[15] = 1;
 697   8                                                                              
 698   8                                                                      }break;
 699   7                                                                      
 700   7                                                                      case cmdConfigTim_closeLoopSwConfig:{
 701   8                                                                      
 702   8                                                                              repeatTX_buff[14] = delayPeriod_closeLoop;
 703   8                                                                              
 704   8                                                                      }break;
 705   7                                                                      
 706   7                                                                      default:break;
 707   7                                                              }
 708   6                                                      }break;
 709   5                                                      
 710   5                                                      /*APÄ£Ê½ÅäÖÃÖ¸Áî*/
 711   5                                                      case FRAME_MtoSCMD_cmdConfigAP:{        
 712   6                                                      
 713   6                                                              //´ËÖ¸Áî²»³£ÓÃ£¬ ±£Áô
 714   6                                                      }break;
 715   5                                                      
 716   5                                                      /*ÌáÊ¾ÒôÊ¹ÄÜÖ¸Áî*/
 717   5                                                      case FRAME_MtoSCMD_cmdBeepsON:{         
 718   6                                                      
 719   6                                                              
 720   6                                                      }break;
 721   5                                                      
 722   5                                                      /*ÌáÊ¾ÒôÊ§ÄÜÖ¸Áî*/
 723   5                                                      case FRAME_MtoSCMD_cmdBeepsOFF:{        
 724   6                                                      
 725   6                                                              
 726   6                                                      }break;
 727   5                                                      
 728   5                                                      /*»Ö¸´³ö³§±¾µØÊÇ·ñÖ§³Ö²éÑ¯*/
 729   5                                                      case FRAME_MtoSCMD_cmdftRecoverRQ:{     
 730   6                                                      
 731   6      
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 13  

 732   6                                                      }
 733   5                                                      
 734   5                                                      /*»Ö¸´³ö³§ÉèÖÃÖ¸Áî*/
 735   5                                                      case FRAME_MtoSCMD_cmdRecoverFactory:{  
 736   6                                                      
 737   6      
 738   6                                                      }break;
 739   5                                                      
 740   5                                                      default:break;
 741   5                                              }
 742   4                                              
 743   4                                              if(respond_FLAG){       //Ö÷¶¯ÏìÓ¦»Ø¸´Ö´ÐÐ
 744   5                                              
 745   5                                                      dtasTX_loadBasic_AUTO( repeatTX_buff,                           /*·¢ËÍÇ°×îºó×°ÔØ*///·¢ËÍ°ü»ù±¾ÐÅÏ¢Ìî³ä
 746   5                                                                                                 FRAME_TYPE_StoM_RCVsuccess,
 747   5                                                                                                 cmdParing_Temp,
 748   5                                                                                                 specialCmd_FLAG
 749   5                                                                                               );
 750   5                                                      uartObjWIFI_Send_String(repeatTX_buff, repeatTX_Len);//Êý¾Ý½ÓÊÕ»Ø¸´ÏìÓ¦ 
 751   5                                              }
 752   4                                              
 753   4      //                                      if((HEARTBEAT_objFLAG_SERVER != dataTrans_objWIFI) &&
 754   4      //                                         ((cmdParing_Temp != FRAME_MtoSCMD_cmdConfigSearch) && (DATATRANS_objFLAG_MOBILE == dataTrans_obj
             -WIFI)) \
*** WARNING C329 IN LINE 754 OF dataTrans\dataTrans.c: single-line comment contains line-continuation
 755   4      //                                      )beeps(2);      //ÌáÊ¾Òô,ÐÄÌø°ü²»Ïì,ËÑË÷ÅäÖÃÊ±²»Ïì
 756   4                                              
 757   4                              }break;
 758   3                              
 759   3                              //ÐÄÌø°üÊý¾Ý½âÎö
 760   3                              case HEARTBEAT_objFLAG_SERVER:{
 761   4                              
 762   4                                      switch(rxBuff_WIFI_temp[2]){
 763   5                                      
 764   5                                              case FRAME_HEARTBEAT_cmdEven:{
 765   6                                              
 766   6                                                      
 767   6                                              }break;
 768   5                                                      
 769   5                                              case FRAME_HEARTBEAT_cmdOdd:{           //ÆæÊýÐÄÌøÊ±¼äÐ£×¼
 770   6                                              
 771   6                                                      stt_Time datsTime_temp = {0};
 772   6                                                      
 773   6      //                                              u8 Y    = rxBuff_WIFI_temp[8];
 774   6      //                                              u8 W    = rxBuff_WIFI_temp[8];
 775   6                                                      u8 M    = rxBuff_WIFI_temp[9];
 776   6                                                      u8 D    = rxBuff_WIFI_temp[10];
 777   6      //                                              u8 W    = Y + (Y / 4) + 5 - 40 + (26 * (M + 1) / 10) + D - 1;   //²ÌÀÕ¹«Ê½
 778   6      //                                                 W   %= 7; 
 779   6      //                                              
 780   6      //                                              W?(datsTime_temp.time_Week = W):(datsTime_temp.time_Week = 7);
 781   6                                                      
 782   6                                                      datsTime_temp.time_Year         = 18;
 783   6                                                      datsTime_temp.time_Month        = M;
 784   6                                                      datsTime_temp.time_Day          = D;
 785   6                                                      datsTime_temp.time_Week         = rxBuff_WIFI_temp[8];
 786   6                                                      datsTime_temp.time_Hour         = rxBuff_WIFI_temp[11];
 787   6                                                      datsTime_temp.time_Minute       = rxBuff_WIFI_temp[12];
 788   6                                                      datsTime_temp.time_Second       = rxBuff_WIFI_temp[13];                                         
 789   6                                                      
 790   6                                                      timeSet(datsTime_temp);
 791   6                                                      
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 14  

 792   6                                              }break;
 793   5                                              
 794   5                                              default:break;
 795   5                                      }
 796   4                                      
 797   4                              }break;
 798   3                                      
 799   3                              default:break;
 800   3                      }
 801   2              }
 802   1                      
 803   1              /*************************************ÐÄÌø°üÒµÎñ´úÂë**********************************************/
 804   1              if(heartBeat_Cnt < heartBeat_Period);
 805   1              else{
 806   2              
 807   2                      heartBeat_Cnt = 0;
 808   2                      
 809   2                      memset(&heartBeat_Pack[0], 0, sizeof(u8) * dataHeartBeatLength_objSERVER);
 810   2                      
 811   2                      heartBeat_Pack[0]       = FRAME_HEAD_HEARTBEAT;
 812   2                      heartBeat_Pack[1]       = dataHeartBeatLength_objSERVER;
 813   2      
 814   2                      if(heartBeat_Type){     //ÆæÊýÐÄÌø
 815   3                      
 816   3                              heartBeat_Type = !heartBeat_Type;
 817   3                              
 818   3                              heartBeat_Pack[2]       = FRAME_HEARTBEAT_cmdOdd;
 819   3                              memcpy(&heartBeat_Pack[3], &MAC_ID[1], 5);
 820   3                              
 821   3                              EEPROM_read_n(EEPROM_ADDR_timeZone_H, &timeZone_Hour, 1);
 822   3                              EEPROM_read_n(EEPROM_ADDR_timeZone_M, &timeZone_Minute, 1);
 823   3                              heartBeat_Pack[8] = timeZone_Hour;
 824   3                              heartBeat_Pack[9] = timeZone_Minute;
 825   3                              
 826   3      //                      //²âÊÔ´úÂë¶Î
 827   3      //                      {
 828   3      //                              static u8 test_timeZone_Hour = 0;
 829   3      //                              
 830   3      //                              if(test_timeZone_Hour < 24)test_timeZone_Hour ++;
 831   3      //                              else{
 832   3      //                              
 833   3      //                                      test_timeZone_Hour = 0;
 834   3      //                              }
 835   3      //                              
 836   3      //                              heartBeat_Pack[8] = test_timeZone_Hour;
 837   3      //                              heartBeat_Pack[9] = 0;
 838   3      //                      }
 839   3                              
 840   3                              {
 841   4                              u16 integer_prt = (u16)elec_Consum & 0x00FF;    //µçÁ¿ÕûÊý²¿·Ö
 842   4                              u16 decimal_prt = (u16)((elec_Consum - (float)integer_prt) * 10000.0F); //µçÁ¿Ð¡Êý²¿·ÖÇ¿×ªÎªÕûÊýÀàÐÍ
 843   4                              
 844   4                              heartBeat_Pack[10]      = (u8)((integer_prt & 0x00FF) >> 0);    //ÕûÊý²¿·ÖÌî×°
 845   4                              heartBeat_Pack[11]      = (u8)((decimal_prt & 0xFF00) >> 8);    //Ð¡Êý²¿·ÖÌî×°
 846   4                              heartBeat_Pack[12]      = (u8)((decimal_prt & 0x00FF) >> 0);    //Ð¡Êý²¿·ÖÌî×°
 847   4                              }
 848   3                              
 849   3                              {
 850   4                              u16 integer_prt = (u16)paramElec_Param.ePower & 0xFFFF; //¹¦ÂÊÕûÊý²¿·Ö
 851   4                              u16 decimal_prt = (u16)((paramElec_Param.ePower - (float)integer_prt) * 10000.0F);      //¹¦ÂÊÐ¡Êý²¿·ÖÇ¿×ªÎª
             -ÕûÊýÀàÐÍ
 852   4                              
C51 COMPILER V9.54   DATATRANS                                                             09/07/2018 15:49:47 PAGE 15  

 853   4                              heartBeat_Pack[13]      = (u8)((integer_prt & 0xFF00) >> 8);    //ÕûÊý²¿·ÖÌî×°
 854   4                              heartBeat_Pack[14]      = (u8)((integer_prt & 0x00FF) >> 0);    //ÕûÊý²¿·ÖÌî×°
 855   4                              heartBeat_Pack[15]      = (u8)((decimal_prt & 0xFF00) >> 8);    //Ð¡Êý²¿·ÖÌî×°
 856   4                              heartBeat_Pack[16]      = (u8)((decimal_prt & 0x00FF) >> 0);    //Ð¡Êý²¿·ÖÌî×°
 857   4                              }
 858   3                              
 859   3                              heartBeat_Pack[17]      = elec_Consum_moment;   //¶ÔÓ¦Ê±¶Î±êÖ¾Ìî×°
 860   3                              
 861   3                      }else{  //Å¼ÊýÐÄÌø
 862   3                      
 863   3                              heartBeat_Type = !heartBeat_Type;
 864   3                              
 865   3                              heartBeat_Pack[2]       = FRAME_HEARTBEAT_cmdEven;
 866   3                              memcpy(&heartBeat_Pack[3], &MAC_ID[1], 5);
 867   3                              
 868   3                              heartBeat_Pack[8]       = deviceLock_flag;
 869   3                              heartBeat_Pack[9]       = ifTim_sw_running_FLAG;
 870   3                              heartBeat_Pack[10]      = status_Relay;
 871   3                              heartBeat_Pack[11]      = (ifDelay_sw_running_FLAG & 0x01) >> 0; //ÂÌÉ«Ä£Ê½
 872   3                      }
 873   2                      
 874   2                      heartBeat_Pack[18]      = SWITCH_TYPE_FP;
 875   2                      heartBeat_Pack[19]      = FRAME_TAIL_HEARTBEAT;
 876   2      
 877   2                      uartObjWIFI_Send_String(heartBeat_Pack, dataHeartBeatLength_objSERVER);
 878   2              }
 879   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2824    ----
   CONSTANT SIZE    =    224    ----
   XDATA SIZE       =    138     172
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      6       6
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)

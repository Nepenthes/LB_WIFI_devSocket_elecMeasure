C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DATATRANS
OBJECT MODULE PLACED IN .\Output\dataTrans.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE dataTrans\dataTrans.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE INCDIR(
                    -..\Proj_sw_ElecMeasure;.\Usr;.\Usr_lib;.\std_Lib;.\hwDriver;.\dataTrans) DEBUG PRINT(.\Listings\dataTrans.lst) OBJECT(.\
                    -Output\dataTrans.obj)

line level    source

   1          #include "dataTrans.h"
   2          
   3          #include "pars_Method.h"
   4          #include "dataManage.h"
   5          #include "wifi_LPT220.h"
   6          #include "HYM8564.h"
   7          #include "HW8012.h"
   8          #include "Relay.h"
   9          #include "Tips.h"
  10          
  11          #include "string.h"
  12          #include "stdio.h"
  13          
  14          #include "USART.h"
  15          #include "soft_uart.h"
  16          #include "eeprom.h"
  17          #include "delay.h"
  18          
  19          //*********************MACµØÖ·Ïà¹Ø±äÁ¿ÒýÓÃÇø*********************/
  20          extern u8 xdata                 MAC_ID[6];
  21          
  22          //*********************¶¨Ê±¶¯×÷Ïß³ÌÏà¹Ø±äÁ¿ÒýÓÃÇø****************/
  23          extern  u8                              swTim_onShoot_FLAG;             //ÆÕÍ¨¿ª¹Ø¶¨Ê±Ò»´ÎÐÔ±êÖ¾¡ª¡ªµÍËÄÎ»±êÊ¶ËÄ¸ö¶¨Ê±Æ÷
  24          extern  bit                             ifTim_sw_running_FLAG;  //ÆÕÍ¨¿ª¹Ø¶¨Ê±ÔËÐÐ±êÖ¾Î»
  25          
  26          extern u8                               ifDelay_sw_running_FLAG;        //ÑÓÊ±¶¯×÷_ÊÇ·ñÔËÐÐ±êÖ¾Î»£¨bit 1ÑÓÊ±¿ª¹ØÔËÐÐÊ¹ÄÜ±êÖ¾£¬bit 0¶¨Ê±¹Ø±Õ
             -ÔËÐÐÊ¹ÄÜ±êÖ¾£©
  27          extern u16                              delayCnt_onoff;
  28          extern u8                               delayPeriod_onoff;
  29          extern bit                              delayUp_act;
  30          extern u16                              delayCnt_closeLoop;
  31          extern u8                               delayPeriod_closeLoop;
  32          
  33          //*********************µçÁ¿¼ì²âÏß³ÌÏà¹Ø±äÁ¿ÒýÓÃÇø****************/
  34          extern  elec_Param      xdata paramElec_Param;  //µç²ÎÊý±äÁ¿
  35          extern  float           xdata elec_Consum;
  36          
  37          //*********************µçÁ¿¼ì²âÏß³ÌÏà¹Ø±äÁ¿ÒýÓÃÇø****************/
  38          extern  bit                     status_Relay;
  39          
  40          /**********************±¾µØÎÄ¼þ±äÁ¿¶¨ÒåÇø************************/
  41          //´®¿Ú½ÓÊÕ³¬Ê±±êÖ¾
  42          bit uartRX_toutFLG                                              = 0;
  43          //´®¿Ú½ÓÊÕ³¬Ê±¼ÆÊý
  44          bit rxTout_count_EN                                     = 0;
  45          u8  rxTout_count                                                = 0;
  46          //´®¿ÚÊý¾Ý»º´æ
  47          u8      datsRcv_length                                          = 0;
  48          uartTout_datsRcv xdata datsRcv_ZIGB     = {{0}, 0};
  49          
  50          //µ±Ç°½ÓÊÕÉÏÎ»»úÄ£Ê½±êÊ¶
  51          dataTrans_obj   dataTrans_objWIFI               = DATATRANS_objFLAG_MOBILE;
  52          
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 2   

  53          //ÉÏÎ»»úÏÂ´ï¿ª¹ØÃüÁî±êÖ¾
  54          switch_Status   swStatus_fromUsr                = swStatus_null;
  55          
  56          //Êý¾Ý°üÏìÓ¦»Ø¸´³¤¶È¡ª¡ªÄ¬ÈÏ¾ÖÓòÍøÊý¾Ý³¤¶È
  57          u8 xdata                repeatTX_Len                    = dataTransLength_objMOBILE;
  58          
  59          //Ô¶¶ËMACID»º´æ
  60          u8      xdata           Dst_MACID_Temp[6]               = {0};
  61          
  62          //ÐÄÌø°üÆæÅ¼±êÖ¾
  63          bit                     heartBeat_Type                  = 0;    //ÆæÅ¼°ü±êÖ¾£¬ÆæÊý°ü1£¬Å¼Êé°ü0
  64          //ÐÄÌø°üÖÜÆÚ¼ÆÊýÖµ
  65          u16     xdata           heartBeat_Cnt                   = 0;
  66          //ÐÄÌø°ü¼ÆÊýÖÜÆÚ
  67          const   u32     heartBeat_Period                = 8000;         //ÐÄÌø°üÖÜÆÚÉèÖÃºÁÃëÏµÊýÖµ * 50us£¨¶¨Ê±Æ÷ÄÚ¼ÆÊý£©
  68          
  69          //±¾µØ¿ª¹Ø×´Ì¬¹ã²¥Ê¹ÄÜ
  70          bit swDataBroadcast_IF                                  = 0;
  71          
  72          /*--------------------------------------------------------------*/
  73          void uartObjWIFI_Init(void){
  74   1              
  75   1              EA = 0;
  76   1      
  77   1              PS = 1;
  78   1              SCON = (SCON & 0x3f) | UART_8bit_BRTx;
  79   1      
  80   1      {
  81   2              u32 j = (MAIN_Fosc / 4) / BAUD_WIFI;    //°´1T¼ÆËã
  82   2                      j = 65536UL - j;
  83   2              
  84   2              TH2 = (u8)(j>>8);
  85   2              TL2 = (u8)j;
  86   2      }
  87   1              AUXR &= ~(1<<4);        //Timer stop
  88   1              AUXR |= 0x01;           //S1 BRT Use Timer2;
  89   1              AUXR &= ~(1<<3);        //Timer2 set As Timer
  90   1              AUXR |=  (1<<2);        //Timer2 set as 1T mode
  91   1      
  92   1              IE2  &= ~(1<<2);        //½ûÖ¹ÖÐ¶Ï
  93   1              AUXR &= ~(1<<3);        //¶¨Ê±
  94   1              AUXR |=  (1<<4);        //Timer run enable
  95   1      
  96   1              ES        = 1;
  97   1              REN   = 1;
  98   1              P_SW1 = (P_SW1 & 0x3f) | (UART1_SW_P30_P31 & 0xc0);
  99   1              
 100   1              memset(TX1_Buffer, 0, sizeof(char) * COM_TX1_Lenth);
 101   1      
 102   1              EA = 1;
 103   1              
 104   1              PrintString1("i'm UART1 for wifi data translate !!!");
 105   1      }
 106          
 107          /*----------------------------
 108          ·¢ËÍ´®¿ÚÊý¾Ý
 109          ----------------------------*/
 110          void uartObjWIFI_Send_Byte(u8 dat)      //´®¿Ú1
 111          {
 112   1              TX1_write2buff(dat);
 113   1      }
 114          
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 3   

 115          void uartObjWIFI_Send_String(char *s,unsigned char ucLength){    //´®¿Ú1
 116   1              
 117   1              uart1_datsSend(s, ucLength);
 118   1      }
 119          
 120          void rxBuff_WIFI_Clr(void){
 121   1      
 122   1              memset(rxBuff_WIFI, 0xff, sizeof(char) * COM_RX1_Lenth);
 123   1              COM1.RX_Cnt = 0;
 124   1      }
 125          
 126          /********************* ×Ô¶¨ÒåÐ£Ñé*****************************/
 127          unsigned char frame_Check(unsigned char frame_temp[], u8 check_num){
 128   1        
 129   1              unsigned char loop              = 0;
 130   1              unsigned char val_Check = 0;
 131   1              
 132   1              for(loop = 0; loop < check_num; loop ++){
 133   2              
 134   2                      val_Check += frame_temp[loop];
 135   2              }
 136   1              
 137   1              val_Check  = ~val_Check;
 138   1              val_Check ^= 0xa7;
 139   1              
 140   1              return val_Check;
 141   1      }
 142          
 143          /*´ËÊý¾Ý·â×°±ØÐëÔÚÊý¾Ý°ü·¢ËÍÇ°×îºóµ÷ÓÃ£¬×Ô¶¯¸ù¾ÝÉÏ´ÎÊý¾Ý´«ÊäÊ±µÄ¶ÔÏó½øÐÐÊý¾Ý·â×°*///±ÜÃâÐ£Ñé±»ÌáÇ°¶ø³ö´í
 144          void dtasTX_loadBasic_AUTO(u8 dats_Tx[45],              //·¢ËÍ°üÊý¾Ý»º´æ»ù±¾ÐÅÏ¢Ìî×°
 145                                                             u8 frame_Type,
 146                                                             u8 frame_CMD,
 147                                                             bit ifSpecial_CMD){  
 148   1                                                        
 149   1              switch(repeatTX_Len){
 150   2              
 151   2                      /*·þÎñÆ÷Êý¾Ý°üÌî×°*///45×Ö½Ú
 152   2                      case dataTransLength_objSERVER:{
 153   3                              
 154   3                              u8 xdata datsTemp[32] = {0};
 155   3                      
 156   3                              dats_Tx[0]      = FRAME_HEAD_SERVER;
 157   3                              
 158   3                              memcpy(&datsTemp[0], &dats_Tx[1], 32);
 159   3                              memcpy(&dats_Tx[13], &datsTemp[0], 32); //Ö¡Í·ºóÀ­¿ª¿Õ³ö12¸ö×Ö½Ú
 160   3                              memcpy(&dats_Tx[1],  &Dst_MACID_Temp[0], 6);    //Ô¶¶ËMACIDÌî³ä
 161   3      #if(SMARTSWITCH_IF != 1)
 162   3                              memcpy(&dats_Tx[8],  &MAC_ID[1], 5);    /*dats_Tx[7] ÔÝÊ±Ìî0*///Ô¶¶ËMACIDÌî³ä
 163   3      #else
                                      memcpy(&dats_Tx[7],  &MAC_ID[0], 6);    /*ÀÏ°æAPPÈ«MACÌî³ä*///Ô¶¶ËMACIDÌî³ä
              #endif
 166   3                              
 167   3                              dats_Tx[1 + 12] = dataTransLength_objSERVER;
 168   3                              dats_Tx[2 + 12] = frame_Type;
 169   3                              dats_Tx[3 + 12] = frame_CMD;
 170   3                              
 171   3                              if(!ifSpecial_CMD)dats_Tx[10 + 12] = SWITCH_TYPE_FP;    //¿ª¹ØÀàÐÍÌî³ä
 172   3                              
 173   3      #if(SMARTSWITCH_IF != 1)
 174   3                                      memcpy(&dats_Tx[5 + 12], &MAC_ID[1], 5);        //MACÌî³ä
 175   3                                      dats_Tx[4 + 12] = frame_Check(&dats_Tx[5 + 12], 28);    //Ð£ÑéÂë                
 176   3      #else           
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 4   

                                              memcpy(&dats_Tx[4 + 12], &MAC_ID[0], 6);        //MACÌî³ä-ÀÏ°æAPP MACµØÖ·Îª6Î»£¬´ÓD16¿ªÊ¼
              #endif
 179   3                              
 180   3                      }break;
 181   2                      
 182   2                      /*¾ÖÓòÍøÊý¾Ý°üÌî×°*///33×Ö½Ú
 183   2                      case dataTransLength_objMOBILE:{
 184   3                      
 185   3                              dats_Tx[0]      = FRAME_HEAD_MOBILE;
 186   3                              
 187   3                              dats_Tx[1]      = dataTransLength_objMOBILE;
 188   3                              dats_Tx[2]      = frame_Type;
 189   3                              dats_Tx[3]      = frame_CMD;
 190   3                              
 191   3                              if(!ifSpecial_CMD)dats_Tx[10] = SWITCH_TYPE_FP; //¿ª¹ØÀàÐÍÌî³ä
 192   3                              
 193   3      #if(SMARTSWITCH_IF != 1)
 194   3                                      memcpy(&dats_Tx[5], &MAC_ID[1], 5);     //MACÌî³ä
 195   3                                      dats_Tx[4]      = frame_Check(&dats_Tx[5], 28); //Ð£ÑéÂë                
 196   3      #else
                                              memcpy(&dats_Tx[4], &MAC_ID[0], 6);     //MACÌî³ä-ÀÏ°æAPP MACµØÖ·Îª6Î»£¬´ÓD4¿ªÊ¼
              #endif
 199   3                              
 200   3                      }break;
 201   2                      
 202   2                      default:break;
 203   2              }       
 204   1      }
 205                                                             
 206          /*´ËÊý¾Ý·â×°±ØÐëÔÚÊý¾Ý°ü·¢ËÍÇ°×îºóµ÷ÓÃ£¬×Ô¶¨Òå¶ÔÏó½øÐÐÊý¾Ý·â×°*///±ÜÃâÐ£Ñé±»ÌáÇ°¶ø³ö´í
 207          void dtasTX_loadBasic_CUST(dataTrans_obj obj_custom,    //·¢ËÍ°üÊý¾Ý»º´æ»ù±¾ÐÅÏ¢Ìî×°
 208                                                             u8 dats_Tx[45],              
 209                                                             u8 frame_Type,
 210                                                             u8 frame_CMD,
 211                                                             bit ifSpecial_CMD){  
 212   1                                                        
 213   1              switch(obj_custom){
 214   2              
 215   2                      /*·þÎñÆ÷Êý¾Ý°üÌî×°*///45×Ö½Ú
 216   2                      case DATATRANS_objFLAG_SERVER:{
 217   3                              
 218   3                              u8 xdata datsTemp[32] = {0};
 219   3                      
 220   3                              dats_Tx[0]      = FRAME_HEAD_SERVER;
 221   3                              
 222   3                              memcpy(&datsTemp[0], &dats_Tx[1], 32);
 223   3                              memcpy(&dats_Tx[13], &datsTemp[0], 32); //Ö¡Í·ºóÀ­¿ª¿Õ³ö12¸ö×Ö½Ú
 224   3                              memcpy(&dats_Tx[1],  &Dst_MACID_Temp[0], 6);    //Ô¶¶ËMACIDÌî³ä
 225   3                              memcpy(&dats_Tx[8],  &MAC_ID[1], 5);    /*dats_Tx[7] ÔÝÊ±Ìî0*///Ô¶¶ËMACIDÌî³ä
 226   3                              
 227   3                              dats_Tx[1 + 12] = dataTransLength_objSERVER;
 228   3                              dats_Tx[2 + 12] = frame_Type;
 229   3                              dats_Tx[3 + 12] = frame_CMD;
 230   3                              
 231   3                              if(!ifSpecial_CMD)dats_Tx[10 + 12] = SWITCH_TYPE_FP;    //¿ª¹ØÀàÐÍÌî³ä
 232   3                              
 233   3      #if(SMARTSWITCH_IF != 1)
 234   3                              memcpy(&dats_Tx[5 + 12], &MAC_ID[1], 5);        //MACÌî³ä
 235   3                              dats_Tx[4 + 12] = frame_Check(&dats_Tx[5 + 12], 28);    //Ð£ÑéÂë                
 236   3      #else           
                                      memcpy(&dats_Tx[4 + 12], &MAC_ID[0], 6);        //MACÌî³ä-ÀÏ°æAPP MACµØÖ·Îª6Î»£¬´ÓD16¿ªÊ¼
              #endif
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 5   

 239   3                              
 240   3                      }break;
 241   2                      
 242   2                      /*¾ÖÓòÍøÊý¾Ý°üÌî×°*///33×Ö½Ú    --³ýÁË45¶¼ÊÇ33Ìî×°
 243   2                      case DATATRANS_objFLAG_MOBILE:
 244   2                      
 245   2                      default:{
 246   3                      
 247   3                              dats_Tx[0]      = FRAME_HEAD_MOBILE;
 248   3                              
 249   3                              dats_Tx[1]      = dataTransLength_objMOBILE;
 250   3                              dats_Tx[2]      = frame_Type;
 251   3                              dats_Tx[3]      = frame_CMD;
 252   3                              
 253   3                              if(!ifSpecial_CMD)dats_Tx[10] = SWITCH_TYPE_FP; //¿ª¹ØÀàÐÍÌî³ä
 254   3                              
 255   3      #if(SMARTSWITCH_IF != 1)
 256   3                              memcpy(&dats_Tx[5], &MAC_ID[1], 5);     //MACÌî³ä
 257   3                              dats_Tx[4]      = frame_Check(&dats_Tx[5], 28); //Ð£ÑéÂë                
 258   3      #else
                                      memcpy(&dats_Tx[4], &MAC_ID[0], 6);     //MACÌî³ä-ÀÏ°æAPP MACµØÖ·Îª6Î»£¬´ÓD4¿ªÊ¼
              #endif
 261   3                      
 262   3                      }break;
 263   2              }       
 264   1      }
 265          
 266          /********************* UART1(WIIF)ÖÐ¶Ïº¯Êý_×Ô¶¨ÒåÖØ¹¹************************/
 267          void UART1_Rountine (void) interrupt UART1_VECTOR
 268          {
 269   1              
 270   1              EA = 0;
 271   1              
 272   1              if(RI)
 273   1              {
 274   2                      RI = 0;
 275   2                      if(COM1.B_RX_OK == 0)
 276   2                      {               
 277   3                              if(!rxTout_count_EN){
 278   4                              
 279   4                                      rxTout_count_EN = 1;
 280   4                                      rxTout_count    = 0;
 281   4                                      datsRcv_length  = 0;
 282   4                                      
 283   4                                      memset(RX1_Buffer, 0xff, sizeof(char) * COM_RX1_Lenth);
 284   4                              }
 285   3                              
 286   3                              RX1_Buffer[datsRcv_length ++] = SBUF;
 287   3                              rxTout_count = 0;
 288   3                      }
 289   2              }
 290   1      
 291   1              if(TI)
 292   1              {
 293   2                      TI = 0;
 294   2                      if(COM1.TX_read != COM1.TX_write)
 295   2                      {
 296   3                              SBUF = TX1_Buffer[COM1.TX_read];
 297   3                              if(++COM1.TX_read >= COM_TX1_Lenth)             COM1.TX_read = 0;
 298   3                      }
 299   2                      else    COM1.B_TX_busy = 0;
 300   2              }
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 6   

 301   1              
 302   1              EA = 1;
 303   1      }
 304          
 305          /***********Ö÷¶¯Êý¾Ý¼ì²â¼ì²âÁ¢Âí¸üÐÂÐÄÌø°ü**************/
 306          void thread_LocalStaus_Release(void){
 307   1      
 308   1              static bit                              Local_ifTim_sw_running_FLAG                     = 0;
 309   1              static bit                              Local_status_Relay                                      = false;
 310   1              static bit                              Local_deviceLock_flag                           = false;
 311   1              static u8                               Local_ifDelay_sw_running_FLAG           = 0;
 312   1              
 313   1              if((Local_ifTim_sw_running_FLAG                 != ifTim_sw_running_FLAG) ||
 314   1                 (Local_status_Relay                                  != status_Relay) ||
 315   1                 (Local_deviceLock_flag                               != deviceLock_flag) ||
 316   1                 (Local_ifDelay_sw_running_FLAG               != ifDelay_sw_running_FLAG)
 317   1              ){
 318   2                      
 319   2                      heartBeat_Cnt   = heartBeat_Period - 100;       //Á¢¼´¸üÐÂÅ¼ÊýÐÄÌø¡ª¡ª×´Ì¬°ü£¬µÈ100ms£¬·ÀÖ¹Ä£¿éÕ³°ü
 320   2                      heartBeat_Type  = 0;    //Å¼Êý°ü
 321   2                              
 322   2                      Local_ifTim_sw_running_FLAG             = ifTim_sw_running_FLAG;
 323   2                      Local_status_Relay                                      = status_Relay;
 324   2                      Local_deviceLock_flag                           = deviceLock_flag;
 325   2                      Local_ifDelay_sw_running_FLAG           = ifDelay_sw_running_FLAG;
 326   2              }
 327   1      }
 328          
 329          /********************* Êý¾Ý´«Êä¼°½âÎö************************/
 330          void thread_dataTrans(void){
 331   1              
 332   1              static u8 timeZone_Hour         = 0;
 333   1              static u8 timeZone_Minute       = 0;
 334   1              
 335   1              unsigned char xdata repeatTX_buff[45]   = {0};
 336   1              unsigned char xdata rxBuff_WIFI_temp[45]= {0};
 337   1                      
 338   1              unsigned char frameLength                               = 0;
 339   1      
 340   1              bit datsQualified_FLG                                   = 0;    
 341   1              bit Parsing_EN                                                  = 0;
 342   1              
 343   1              u8 xdata heartBeat_Pack[dataHeartBeatLength_objSERVER] = {0};   
 344   1              
 345   1              static u8 elec_Consum_moment                    = 0;    //ÓÃµçÁ¿¶ÔÓ¦Ê±¶Î±êÖ¾£¬µçÁ¿Ö»ÊÇÃ¿Ð¡Ê±µÄÓÃµçÁ¿
 346   1              
 347   1              /*********************************Êý¾Ý°ü²É¼¯**********************************/
 348   1              if(uartRX_toutFLG){ //³¬Ê±¶ÏÖ¡
 349   2              
 350   2                      uartRX_toutFLG = 0;
 351   2                      
 352   2                      memset(rxBuff_WIFI_temp, 0, 45 * sizeof(u8));
 353   2                      
 354   2                      if((datsRcv_ZIGB.rcvDats[0] == FRAME_HEAD_SERVER) && 
 355   2      #if(SMARTSWITCH_IF != 1)
 356   2                         (datsRcv_ZIGB.rcvDats[13] == dataTransLength_objSERVER) &&
 357   2      #endif  
 358   2                         (datsRcv_ZIGB.rcvDats[14] == FRAME_TYPE_MtoS_CMD) 
 359   2      #if(SMARTSWITCH_IF != 1)
 360   2                              && (datsRcv_ZIGB.rcvDatsLen >= dataTransLength_objSERVER)
 361   2      #endif  
 362   2                              ){ /*ÉÏÎ»»ú·¢ÁË¸ö×Ö½Ú*/
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 7   

 363   3                              
 364   3                              memcpy(&Dst_MACID_Temp[0], &datsRcv_ZIGB.rcvDats[7], 6);  //Ô¶¶ËMACIDÔÝ´æ       
 365   3                              rxBuff_WIFI_temp[0] = datsRcv_ZIGB.rcvDats[0]; //Ö¡Í·¸³Öµ
 366   3                              memcpy(&rxBuff_WIFI_temp[1], &datsRcv_ZIGB.rcvDats[13], 32);    //Êý¾Ý¼ÓÔØ£¬Ö¡¶ÔÆë£¬¶ÔÆë³É33×Ö½Ú
 367   3                              
 368   3                              //ÏìÓ¦»Ø¸´¶ÔÏóÊôÐÔ¸üÐÂ  
 369   3                              dataTrans_objWIFI = DATATRANS_objFLAG_SERVER;
 370   3                              repeatTX_Len      = dataTransLength_objSERVER;
 371   3                              
 372   3                              frameLength = dataTransLength_objSERVER;
 373   3                              datsQualified_FLG = 1;
 374   3                                      
 375   3                      }else
 376   2                      if((datsRcv_ZIGB.rcvDats[0] == FRAME_HEAD_MOBILE) && 
 377   2      #if(SMARTSWITCH_IF != 1)        
 378   2                         (datsRcv_ZIGB.rcvDats[1] == dataTransLength_objMOBILE) &&
 379   2      #endif  
 380   2                         (datsRcv_ZIGB.rcvDats[2] == FRAME_TYPE_MtoS_CMD) 
 381   2      #if(SMARTSWITCH_IF != 1)                
 382   2                              && (datsRcv_ZIGB.rcvDatsLen == dataTransLength_objMOBILE)
 383   2      #endif          
 384   2                              ){
 385   3                      
 386   3                              memcpy(rxBuff_WIFI_temp, datsRcv_ZIGB.rcvDats, dataTransLength_objMOBILE);      //Êý¾Ý¼ÓÔØ
 387   3                              
 388   3                              //ÏìÓ¦»Ø¸´¶ÔÏóÊôÐÔ¸üÐÂ  
 389   3                              dataTrans_objWIFI = DATATRANS_objFLAG_MOBILE;
 390   3                              repeatTX_Len      = dataTransLength_objMOBILE;
 391   3                                      
 392   3                              frameLength = dataTransLength_objMOBILE;
 393   3                              datsQualified_FLG = 1;
 394   3                                      
 395   3                      }else
 396   2                      if((datsRcv_ZIGB.rcvDats[0] == FRAME_HEAD_HEARTBEAT) && 
 397   2                         (datsRcv_ZIGB.rcvDats[1] == dataHeartBeatLength_objSERVER) 
 398   2      #if(SMARTSWITCH_IF != 1)                        
 399   2                              && (datsRcv_ZIGB.rcvDatsLen == 14)
 400   2      #endif          
 401   2                              ){ /*·þÎñÆ÷»ØµÄ»¹ÊÇ14×Ö½Ú*///µ«ÊÇÖ¡³¤Îª20£¬ÎÒ·¢µÄ20×Ö½Ú£¬·þÎñÆ÷ÒÀÈ»»Ø14×Ö½Ú
 402   3                              
 403   3                              memcpy(rxBuff_WIFI_temp, datsRcv_ZIGB.rcvDats, 14);     //Êý¾Ý¼ÓÔØ
 404   3                              
 405   3                              //ÏìÓ¦»Ø¸´¶ÔÏóÊôÐÔ¸üÐÂ  --²»½øÐÐrepeatTX_Len¸üÐÂ£¡£¡£¡
 406   3                              dataTrans_objWIFI = HEARTBEAT_objFLAG_SERVER;
 407   3                                 
 408   3                              frameLength = dataHeartBeatLength_objSERVER;
 409   3                              datsQualified_FLG = 1;
 410   3                                 
 411   3                      }else{
 412   3                      
 413   3                              dataTrans_objWIFI = dataTrans_obj_NULL;
 414   3                              datsQualified_FLG = 0;
 415   3                      }
 416   2              }
 417   1              
 418   1              /*********************************Êý¾Ý°üÀàÐÍÕç±ð**********************************/     
 419   1              if(datsQualified_FLG){
 420   2                      
 421   2                      bit frameCodeCheck_PASS = 0; //Ð£ÑéÂë¼ì²éÍ¨¹ý±êÖ¾
 422   2                      bit frameMacCheck_PASS  = 0; //macµØÖ·´ý¼ì²éÍ¨¹ý±êÖ¾
 423   2                      
 424   2                      datsQualified_FLG = 0;
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 8   

 425   2              
 426   2                      switch(frameLength){
 427   3                      
 428   3                              case dataTransLength_objSERVER:
 429   3                              case dataTransLength_objMOBILE:{
 430   4                              
 431   4                                      if(rxBuff_WIFI_temp[4] == frame_Check(&rxBuff_WIFI_temp[5], 28))frameCodeCheck_PASS = 1; //Ð£ÑéÂë¼ì²é
 432   4      #if(SMARTSWITCH_IF == 1)
                                              if(!memcmp(&rxBuff_WIFI_temp[4], &MAC_ID[0], 6))frameMacCheck_PASS  = 1; //macµØÖ·¼ì²é  
              #else
 435   4                                      if(!memcmp(&rxBuff_WIFI_temp[5], &MAC_ID[1], 5))frameMacCheck_PASS  = 1; //macµØÖ·¼ì²é
 436   4      #endif
 437   4                                      if(rxBuff_WIFI_temp[3] == FRAME_MtoSCMD_cmdCfg_swTim){ //²»ÓÃ½øÐÐÐ£ÑéÂë¼ì²éµÄÖ¸Áî
 438   5                                      
 439   5                                              frameCodeCheck_PASS = 1;        
 440   5                                      }
 441   4                                      if((rxBuff_WIFI_temp[3] == FRAME_MtoSCMD_cmdConfigSearch) || (rxBuff_WIFI_temp[3] == FRAME_MtoSCMD_cmd
             -Query)){ //²»ÓÃ½øÐÐmacµØÖ·¼ì²éµÄÖ¸Áî
 442   5                                      
 443   5                                              frameMacCheck_PASS = 1; 
 444   5                                      }                       
 445   4      #if(SMARTSWITCH_IF == 1)
                                              frameCodeCheck_PASS = 1; //ÀÏ°æAPP²»ÒªÐ£Ñé
              #endif                  
 448   4                                      if(frameMacCheck_PASS & frameMacCheck_PASS){ //Ö¸ÁîÑéÖ¤
 449   5                                              
 450   5                                              Parsing_EN = 1; 
 451   5                                              
 452   5                                      }else{
 453   5                                      
 454   5      //                                      if(!frameMacCheck_PASS)uartObjWIFI_Send_String("fuck mac", 8);
 455   5      //                                      if(!frameMacCheck_PASS)uartObjWIFI_Send_String("fuck code", 9);rxBuff_WIFI_temp
 456   5      //                                      uartObjWIFI_Send_String(rxBuff_WIFI_temp, 33);
 457   5                                      }
 458   4                                      
 459   4                              }break;
 460   3                              
 461   3                              case dataHeartBeatLength_objSERVER:{
 462   4                              
 463   4                                      if(!memcmp(&rxBuff_WIFI_temp[3], &MAC_ID[1], 5)){       //MACµØÖ·±¾µØ±È¶Ô
 464   5                                              
 465   5                                              Parsing_EN = 1; 
 466   5                                      }
 467   4                                      
 468   4                              }break;
 469   3                              
 470   3                              default:{
 471   4                      
 472   4                                      Parsing_EN = 0; 
 473   4                                      
 474   4                              }break;
 475   3                      }       
 476   2              }
 477   1              
 478   1              /*********************************Êý¾Ý°ü¿ªÊ¼½âÎöÏìÓ¦**********************************/ 
 479   1              if(Parsing_EN){ //¿ªÊ¼½âÎö
 480   2                      
 481   2                      Parsing_EN = 0;
 482   2                      
 483   2                      switch(dataTrans_objWIFI){
 484   3                      
 485   3                              //·þÎñÆ÷
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 9   

 486   3                              case DATATRANS_objFLAG_SERVER:
 487   3                              //¾ÖÓòÍø
 488   3                              case DATATRANS_objFLAG_MOBILE:{
 489   4                                      
 490   4                                              bit specialCmd_FLAG = 0;        /*ÌØÊâÊý¾Ý·â×°±êÖ¾*///Êý¾Ý1ÊÇ·ñÕ¼ÓÃ£¨Ô­Îª¿ª¹ØÀàÐÍ£©
 491   4                                              bit respond_FLAG        = 1;    /*ÊÇ·ñÏàÓ¦»Ø¸´±êÖ¾*///Êý¾Ý½ÓÊÕºóÊÇ·ñÖ÷¶¯»Ø¸´ÏìÓ¦
 492   4                                      
 493   4                                              u8 cmdParing_Temp = rxBuff_WIFI_temp[3];
 494   4                                      
 495   4                                              memset(repeatTX_buff, 0, sizeof(u8) * 45);
 496   4      
 497   4                                              switch(cmdParing_Temp){         //ÃüÁî½âÎö¼°Ê¶±ð
 498   5      
 499   5                                                      /*¿ØÖÆÖ¸Áî*/
 500   5                                                      case FRAME_MtoSCMD_cmdControl:{         
 501   6                                                              
 502   6                                                              switch(rxBuff_WIFI_temp[11]){
 503   7                                                              
 504   7                                                                      case 0x00:{             //¿ª¹Ø_¿ª
 505   8                                                                      
 506   8                                                                              swStatus_fromUsr = swStatus_off;
 507   8                                                                              
 508   8                                                                      }break;
 509   7                                                                              
 510   7                                                                      case 0x01:{             //¿ª¹Ø_¹Ø
 511   8                                                                      
 512   8                                                                              swStatus_fromUsr = swStatus_on;
 513   8      
 514   8                                                                      }break;
 515   7                                                                      
 516   7                                                                      default:break;
 517   7                                                              }
 518   6                                                              
 519   6                                                              repeatTX_buff[11] = rxBuff_WIFI_temp[11];               //¿ª¹Ø×´Ì¬¸üÐÂÌî³ä
 520   6                                                              
 521   6                                                      }break;
 522   5      
 523   5                                                      /*ÅäÖÃËÑË÷Ö¸Áî*/
 524   5                                                      case FRAME_MtoSCMD_cmdConfigSearch:{    
 525   6                                                              
 526   6                                                              u8 xdata serverIP_temp[6] = {0};
 527   6                                                              u8 xdata deviceLock_IF = 0;
 528   6                                                                                              
 529   6                                                              EEPROM_read_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 530   6                                                              EEPROM_read_n(EEPROM_ADDR_serverIP_record, serverIP_temp, 6);
 531   6                                                              
 532   6                                                              //ÉÏËø¼ì²â
 533   6                                                              if(!deviceLock_IF){             
 534   7      #if(SMARTSWITCH_IF != 1)                                                                                        
 535   7                                                                      u8 code port_constTemp[2] = {0, 80};
 536   7                                                                      memcpy(&serverIP_temp[0], &rxBuff_WIFI_temp[6], 4);
 537   7                                                              
 538   7                                                                      //·þÎñÆ÷µØÖ·Í¬²½
 539   7                                                                      if(WIFI_serverUDP_CHG(serverIP_temp, port_constTemp)){
 540   8                                                                              
 541   8      
 542   8                                                                      }else{
 543   8                                                                      
 544   8                                                                      }
 545   7      #else
                                                                              
                                                                              memcpy(&repeatTX_buff[14], serverIP_temp, 6); //ipÐÅÏ¢
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 10  

              #endif
 549   7                                                                      //Ê±¼äÐÅÏ¢Í¬²½
 550   7                                                                      timeZone_Hour   = rxBuff_WIFI_temp[12];         //Ê±Çø¸üÐÂ
 551   7                                                                      timeZone_Minute = rxBuff_WIFI_temp[13];
 552   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_timeZone_H, &timeZone_Hour, 1);
 553   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_timeZone_M, &timeZone_Minute, 1);
 554   7                                                                      
 555   7                                                              }else{
 556   7                                                              
 557   7                                                                      respond_FLAG = 0;
 558   7                                                              }
 559   6                                                              
 560   6                                                      }break;
 561   5      
 562   5      #if(SMARTSWITCH_IF == 1)        
                                                              /*Ô¶¶Ë·þÎñÆ÷¸ü¸ÄÖ¸Áî*/
                                                              case FRAME_MtoSCMD_cmdRemoteServerChg:{
                                                                      
                                                                              u8 xdata serverIP_temp[6] = {0};
                                                                      
                                                                              memcpy(&repeatTX_buff[12], &rxBuff_WIFI_temp[12], 6);
                                                                              memcpy(&serverIP_temp[0], &rxBuff_WIFI_temp[12], 6);
                                                                      
                                                                              dtasTX_loadBasic_AUTO( repeatTX_buff,                           /*·¢ËÍÇ°×îºó×°ÔØ*///·¢ËÍ°ü»ù±¾ÐÅÏ¢Ìî³ä
                                                                                                                         FRAME_TYPE_StoM_RCVsuccess,
                                                                                                                         cmdParing_Temp,
                                                                                                                         specialCmd_FLAG
                                                                                                                       );
                                                                              uartObjWIFI_Send_String(repeatTX_buff, repeatTX_Len);//Êý¾Ý½ÓÊÕ»Ø¸´ÏìÓ¦ 
                                                                              delayMs(10);
                                                                              uartObjWIFI_Send_String(repeatTX_buff, repeatTX_Len);//Êý¾Ý½ÓÊÕ»Ø¸´ÏìÓ¦ 
                                                                      
                                                                              //·þÎñÆ÷µØÖ·Í¬²½
                                                                              WIFI_serverUDP_CHG(&serverIP_temp[2], &serverIP_temp[0]); //ÏÂ±ê12¡¢13¶Ë¿Ú£¬ÏÂ±ê14¿ªÊ¼ÎªIP
                                                                              respond_FLAG = 0;
                                                                              
                                                              }break;
              #endif
 586   5                                                      
 587   5                                                      /*²éÑ¯µÇÂ¼Ö¸Áî*/
 588   5                                                      case FRAME_MtoSCMD_cmdQuery:{   
 589   6                                                              
 590   6                                                              u8 xdata deviceLock_IF          = 0;
 591   6                                                              u8 xdata serverIP_temp[6]       = {0};
 592   6                                                              
 593   6                                                              EEPROM_read_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 594   6                                                              EEPROM_read_n(EEPROM_ADDR_serverIP_record, serverIP_temp, 6);
 595   6      
 596   6                                                              repeatTX_buff[11] = status_Relay;
 597   6                                                              repeatTX_buff[12] = deviceLock_IF;
 598   6                                                              
 599   6                                                              memcpy(&repeatTX_buff[14], serverIP_temp, 6);
 600   6                                                              
 601   6                                                      }break;
 602   5                                                      
 603   5                                                      case FRAME_MtoSCMD_cmdCfg_swTim:{       /*ÆÕÍ¨¿ª¹Ø¶¨Ê±ÅäÖÃÖ¸Áî*/
 604   6                                                              
 605   6                                                              u8 loop = 0;
 606   6                                                              
 607   6                                                              //Ð£Ê±
 608   6                                                              stt_Time datsTime_temp = {0};
 609   6                                                              
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 11  

 610   6                                                              datsTime_temp.time_Year         = rxBuff_WIFI_temp[26];
 611   6                                                              datsTime_temp.time_Month        = rxBuff_WIFI_temp[27];
 612   6                                                              datsTime_temp.time_Day          = rxBuff_WIFI_temp[28];
 613   6                                                              datsTime_temp.time_Hour         = rxBuff_WIFI_temp[29];
 614   6                                                              elec_Consum_moment                      = datsTime_temp.time_Hour;
 615   6                                                              datsTime_temp.time_Minute       = rxBuff_WIFI_temp[30];
 616   6                                                              datsTime_temp.time_Second       = 1;
 617   6                                                              datsTime_temp.time_Week         = rxBuff_WIFI_temp[31];
 618   6                                                              
 619   6                                                              timeSet(datsTime_temp);
 620   6                                                              
 621   6                                                              //¶¨Ê±Êý¾Ý´¦Àí¼°¸üÐÂ,·ÖÀà´¦Àí
 622   6                                                              switch(rxBuff_WIFI_temp[13]){
 623   7                                                              
 624   7                                                                      case 0: 
 625   7                                                                      case cmdConfigTim_normalSwConfig:{      /*ÆÕÍ¨¶¨Ê±*/
 626   8                                                                              
 627   8                                                                              for(loop = 0; loop < 4; loop ++){
 628   9                                                                              
 629   9                                                                                      if(rxBuff_WIFI_temp[14 + loop * 3] == 0x80){    /*Ò»´ÎÐÔ¶¨Ê±ÅÐ¶Ï*///ÖÜÕ¼Î»Îª¿Õ£¬¶ø¶¨Ê±Æ÷±»´ò¿ª£¬ËµÃ
             -÷ÊÇÒ»´ÎÐÔ
 630  10                                                                                      
 631  10                                                                                              swTim_onShoot_FLAG                              |= (1 << loop); //Ò»´ÎÐÔ¶¨Ê±±êÖ¾¿ªÆô
 632  10                                                                                              rxBuff_WIFI_temp[14 + loop * 3] |= (1 << (rxBuff_WIFI_temp[31] - 1)); //Ç¿ÐÐ½øÐÐµ±Ç°ÖÜÕ¼Î»£¬µ±´
             -ÎÖ´ÐÐÍê±ÏºóÇå³ý <rxBuff_WIFI_temp[31]Îªµ±Ç°ÊÚÊ± ÖÜ>
 633  10                                                                                      }
 634   9                                                                              }
 635   8                                                                              coverEEPROM_write_n(EEPROM_ADDR_swTimeTab, &rxBuff_WIFI_temp[14], 12);  //¶¨Ê±±í
 636   8      
 637   8                                                                      }break;
 638   7                                                                      
 639   7                                                                      case cmdConfigTim_onoffDelaySwConfig:{  /*¿ª¹ØÑÓÊ±*/
 640   8                                                                      
 641   8                                                                              if(rxBuff_WIFI_temp[14]){
 642   9                                                                              
 643   9                                                                                      ifDelay_sw_running_FLAG |= (1 << 1);
 644   9                                                                                      delayPeriod_onoff               = rxBuff_WIFI_temp[14];
 645   9                                                                                      
 646   9      //                                                                              if(rxBuff_WIFI_temp[15] == 2)delayUp_act = 1; //2ÎªÑÓÊ±¿ª£¬1ÎªÑÓÊ±¹Ø
 647   9      //                                                                              else delayUp_act = 0;
 648   9                                                                                      
 649   9                                                                                      delayUp_act                             = rxBuff_WIFI_temp[15];
 650   9                                                                                      
 651   9                                                                                      delayCnt_onoff                  = 0;
 652   9                                                                                      
 653   9                                                                              }else{
 654   9                                                                              
 655   9                                                                                      ifDelay_sw_running_FLAG &= ~(1 << 1); //ÎÞÐèµôµç±£´æ
 656   9                                                                                      delayPeriod_onoff               = 0;
 657   9                                                                                      delayCnt_onoff                  = 0;
 658   9                                                                              }
 659   8                                                                              
 660   8                                                                      }break;
 661   7                                                                      
 662   7                                                                      case cmdConfigTim_closeLoopSwConfig:{   /*×Ô¶¯Ñ­»·¹Ø±Õ*/
 663   8                                                                      
 664   8                                                                              if(rxBuff_WIFI_temp[14]){
 665   9                                                                              
 666   9                                                                                      ifDelay_sw_running_FLAG |= (1 << 0);
 667   9                                                                                      delayPeriod_closeLoop   = rxBuff_WIFI_temp[14];
 668   9                                                                                      delayCnt_closeLoop              = 0;
 669   9                                                                              }else{
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 12  

 670   9                                                                              
 671   9                                                                                      ifDelay_sw_running_FLAG &= ~(1 << 0); //ÐèÒªµôµç±£´æ
 672   9                                                                                      delayPeriod_closeLoop   = 0;
 673   9                                                                                      delayCnt_closeLoop              = 0;
 674   9                                                                              }
 675   8                                                                              
 676   8                                                                              coverEEPROM_write_n(EEPROM_ADDR_swDelayFLAG, &ifDelay_sw_running_FLAG, 1);
 677   8                                                                              coverEEPROM_write_n(EEPROM_ADDR_periodCloseLoop, &delayPeriod_closeLoop, 1);
 678   8                                                                              
 679   8                                                                      }break;                                                         
 680   7                                                                      
 681   7                                                                      default:break;
 682   7                                                              }
 683   6                                                              
 684   6                                                              //Êý¾ÝÏìÓ¦¼°»Ø¸´
 685   6                                                              memcpy(&repeatTX_buff[12], &rxBuff_WIFI_temp[12], 14);
 686   6      
 687   6                                                      }break;
 688   5                                                      
 689   5                                                      /*ÅäÖÃ»¥¿ØÖ¸Áî*/
 690   5                                                      case FRAME_MtoSCMD_cmdInterface:{       
 691   6                                                      
 692   6                                                              
 693   6                                                              
 694   6                                                      }break;
 695   5                                                      
 696   5                                                      /*¿ª¹Ø¸´Î»Ö¸Áî*/
 697   5                                                      case FRAME_MtoSCMD_cmdReset:{           
 698   6                                                      
 699   6                                                              
 700   6                                                              
 701   6                                                      }break;
 702   5                                                      
 703   5                                                      /*Éè±¸Ëø¶¨Ö¸Áî¡ª¡ªÉè±¸ÐÅÏ¢ÏìÓ¦Ê§ÄÜ*/
 704   5                                                      case FRAME_MtoSCMD_cmdLockON:{          
 705   6                                                              
 706   6                                                              //Êý¾Ý´¦Àí¼°¶¯×÷ÏìÓ¦
 707   6                                                              {
 708   7                                                                      u8 deviceLock_IF = 1;
 709   7                                                                      
 710   7                                                                      deviceLock_flag  = 1;
 711   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 712   7                                                              }                                                       
 713   6                                                      }break;
 714   5                                                      
 715   5                                                      /*Éè±¸½âËøÖ¸Áî¡ª¡ªÉè±¸ÐÅÏ¢ÏìÓ¦Ê¹ÄÜ*/
 716   5                                                      case FRAME_MtoSCMD_cmdLockOFF:{         
 717   6                                                              
 718   6                                                              //Êý¾Ý´¦Àí¼°¶¯×÷ÏìÓ¦
 719   6                                                              {
 720   7                                                                      u8 deviceLock_IF = 0;
 721   7                                                                      
 722   7                                                                      deviceLock_flag  = 0;
 723   7                                                                      coverEEPROM_write_n(EEPROM_ADDR_deviceLockFLAG, &deviceLock_IF, 1);
 724   7                                                              }                                               
 725   6                                                      }break;
 726   5                                                      
 727   5                                                      /*ÆÕÍ¨¿ª¹Ø¶¨Ê±ÅäÖÃ²éÑ¯Ö¸Áî*/
 728   5                                                      case FRAME_MtoSCMD_cmdswTimQuery:{      
 729   6                                                              
 730   6                                                              repeatTX_buff[12]       = rxBuff_WIFI_temp[12];
 731   6                                                              repeatTX_buff[13]       = rxBuff_WIFI_temp[13];
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 13  

 732   6                                                              
 733   6                                                              //·ÖÀà»Ø¸´
 734   6                                                              switch(rxBuff_WIFI_temp[13]){
 735   7                                                              
 736   7                                                                      case 0: /*ÉÏÎ»»úÔÚ¶¨Ê±µÄÊ±ºò¸ø0£¬´ýÐ­ÉÌ*/
 737   7                                                                      case cmdConfigTim_normalSwConfig:{
 738   8                                                                      
 739   8                                                                              u8 loop = 0;
 740   8                                                                      
 741   8                                                                              //Êý¾ÝÏìÓ¦¼°»Ø¸´
 742   8                                                                              EEPROM_read_n(EEPROM_ADDR_swTimeTab, &repeatTX_buff[14], 12);   //¶¨Ê±±í»Ø¸´Ìî×°
 743   8                                                                              
 744   8                                                                              //»Ø¸´Êý¾Ý¶þ´Î´¦Àí£¨Õë¶ÔÒ»´ÎÐÔ¶¨Ê±Êý¾Ý£©
 745   8                                                                              for(loop = 0; loop < 4; loop ++){
 746   9                                                                              
 747   9                                                                                      if(swTim_onShoot_FLAG & (1 << loop)){
 748  10                                                                                              
 749  10                                                                                              repeatTX_buff[14 + loop * 3] &= 0x80;
 750  10                                                                                      }
 751   9                                                                              }
 752   8                                                                              
 753   8      //                                                                      specialCmd_FLAG = 1;
 754   8                                                                              
 755   8                                                                      }break;
 756   7                                                                      
 757   7                                                                      case cmdConfigTim_onoffDelaySwConfig:{
 758   8                                                                      
 759   8                                                                              if(!delayCnt_onoff)repeatTX_buff[14] = 0;
 760   8                                                                              else repeatTX_buff[14] = delayPeriod_onoff - (u8)(delayCnt_onoff / 60);
 761   8                                                                              repeatTX_buff[15] = delayUp_act;
 762   8      //                                                                      if(delayUp_act)repeatTX_buff[15] = 2;
 763   8      //                                                                      else repeatTX_buff[15] = 1;
 764   8                                                                              
 765   8                                                                      }break;
 766   7                                                                      
 767   7                                                                      case cmdConfigTim_closeLoopSwConfig:{
 768   8                                                                      
 769   8                                                                              repeatTX_buff[14] = delayPeriod_closeLoop;
 770   8                                                                              
 771   8                                                                      }break;
 772   7                                                                      
 773   7                                                                      default:break;
 774   7                                                              }
 775   6                                                      }break;
 776   5                                                      
 777   5                                                      /*APÄ£Ê½ÅäÖÃÖ¸Áî*/
 778   5                                                      case FRAME_MtoSCMD_cmdConfigAP:{        
 779   6                                                      
 780   6                                                              //´ËÖ¸Áî²»³£ÓÃ£¬ ±£Áô
 781   6                                                              
 782   6                                                      }break;
 783   5                                                      
 784   5                                                      /*ÌáÊ¾ÒôÊ¹ÄÜÖ¸Áî*/
 785   5                                                      case FRAME_MtoSCMD_cmdBeepsON:{         
 786   6                                                      
 787   6                                                              beeps_EN = 1;
 788   6                                                              
 789   6                                                      }break;
 790   5                                                      
 791   5                                                      /*ÌáÊ¾ÒôÊ§ÄÜÖ¸Áî*/
 792   5                                                      case FRAME_MtoSCMD_cmdBeepsOFF:{        
 793   6                                                      
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 14  

 794   6                                                              beeps_EN = 0;
 795   6                                                              
 796   6                                                      }break;
 797   5                                                      
 798   5                                                      /*»Ö¸´³ö³§±¾µØÊÇ·ñÖ§³Ö²éÑ¯*/
 799   5                                                      case FRAME_MtoSCMD_cmdftRecoverRQ:{     
 800   6                                                      
 801   6                                                              
 802   6                                                      }
 803   5                                                      
 804   5                                                      /*»Ö¸´³ö³§ÉèÖÃÖ¸Áî*/
 805   5                                                      case FRAME_MtoSCMD_cmdRecoverFactory:{  
 806   6                                                      
 807   6      
 808   6                                                      }break;
 809   5                                                      
 810   5                                                      default:break;
 811   5                                              }
 812   4                                              
 813   4                                              if(respond_FLAG){       //Ö÷¶¯ÏìÓ¦»Ø¸´Ö´ÐÐ
 814   5                                              
 815   5                                                      dtasTX_loadBasic_AUTO( repeatTX_buff,                           /*·¢ËÍÇ°×îºó×°ÔØ*///·¢ËÍ°ü»ù±¾ÐÅÏ¢Ìî³ä
 816   5                                                                                                 FRAME_TYPE_StoM_RCVsuccess,
 817   5                                                                                                 cmdParing_Temp,
 818   5                                                                                                 specialCmd_FLAG
 819   5                                                                                               );
 820   5                                                      uartObjWIFI_Send_String(repeatTX_buff, repeatTX_Len);//Êý¾Ý½ÓÊÕ»Ø¸´ÏìÓ¦ 
 821   5                                              }
 822   4                                              
 823   4      //                                      if((HEARTBEAT_objFLAG_SERVER != dataTrans_objWIFI) &&
 824   4      //                                         ((cmdParing_Temp != FRAME_MtoSCMD_cmdConfigSearch) && (DATATRANS_objFLAG_MOBILE == dataTrans_obj
             -WIFI)) \
*** WARNING C329 IN LINE 824 OF dataTrans\dataTrans.c: single-line comment contains line-continuation
 825   4      //                                      )beeps(2);      //ÌáÊ¾Òô,ÐÄÌø°ü²»Ïì,ËÑË÷ÅäÖÃÊ±²»Ïì
 826   4                                              
 827   4                              }break;
 828   3                              
 829   3                              //ÐÄÌø°üÊý¾Ý½âÎö
 830   3                              case HEARTBEAT_objFLAG_SERVER:{
 831   4                              
 832   4                                      switch(rxBuff_WIFI_temp[2]){
 833   5                                      
 834   5                                              case FRAME_HEARTBEAT_cmdEven:{
 835   6                                              
 836   6                                                      
 837   6                                              }break;
 838   5                                                      
 839   5                                              case FRAME_HEARTBEAT_cmdOdd:{           //ÆæÊýÐÄÌøÊ±¼äÐ£×¼
 840   6                                              
 841   6                                                      stt_Time datsTime_temp = {0};
 842   6                                                      
 843   6      //                                              u8 Y    = rxBuff_WIFI_temp[8];
 844   6      //                                              u8 W    = rxBuff_WIFI_temp[8];
 845   6                                                      u8 M    = rxBuff_WIFI_temp[9];
 846   6                                                      u8 D    = rxBuff_WIFI_temp[10];
 847   6      //                                              u8 W    = Y + (Y / 4) + 5 - 40 + (26 * (M + 1) / 10) + D - 1;   //²ÌÀÕ¹«Ê½
 848   6      //                                                 W   %= 7; 
 849   6      //                                              
 850   6      //                                              W?(datsTime_temp.time_Week = W):(datsTime_temp.time_Week = 7);
 851   6                                                      
 852   6                                                      datsTime_temp.time_Year         = 18;
 853   6                                                      datsTime_temp.time_Month        = M;
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 15  

 854   6                                                      datsTime_temp.time_Day          = D;
 855   6                                                      datsTime_temp.time_Week         = rxBuff_WIFI_temp[8];
 856   6                                                      datsTime_temp.time_Hour         = rxBuff_WIFI_temp[11];
 857   6                                                      datsTime_temp.time_Minute       = rxBuff_WIFI_temp[12];
 858   6                                                      datsTime_temp.time_Second       = rxBuff_WIFI_temp[13];                                         
 859   6      #if(SMARTSWITCH_IF != 1)                                                        
 860   6                                                      timeSet(datsTime_temp);
 861   6      #endif
 862   6                                              }break;
 863   5                                              
 864   5                                              default:break;
 865   5                                      }
 866   4                                      
 867   4                              }break;
 868   3                                      
 869   3                              default:break;
 870   3                      }
 871   2              }
 872   1                      
 873   1              /*************************************ÐÄÌø°üÒµÎñ´úÂë**********************************************/
 874   1              if(heartBeat_Cnt < heartBeat_Period);
 875   1              else{
 876   2              
 877   2                      heartBeat_Cnt = 0;
 878   2                      
 879   2                      memset(&heartBeat_Pack[0], 0, sizeof(u8) * dataHeartBeatLength_objSERVER);
 880   2                      
 881   2                      heartBeat_Pack[0]       = FRAME_HEAD_HEARTBEAT;
 882   2                      heartBeat_Pack[1]       = dataHeartBeatLength_objSERVER;
 883   2      
 884   2                      if(heartBeat_Type){     //ÆæÊýÐÄÌø
 885   3                      
 886   3                              heartBeat_Type = !heartBeat_Type;
 887   3                              
 888   3                              heartBeat_Pack[2]       = FRAME_HEARTBEAT_cmdOdd;
 889   3                              
 890   3                              EEPROM_read_n(EEPROM_ADDR_timeZone_H, &timeZone_Hour, 1);
 891   3                              EEPROM_read_n(EEPROM_ADDR_timeZone_M, &timeZone_Minute, 1);
 892   3                              heartBeat_Pack[9]       = timeZone_Hour;
 893   3                              heartBeat_Pack[10]      = timeZone_Minute;
 894   3                              
 895   3      //                      //²âÊÔ´úÂë¶Î
 896   3      //                      {
 897   3      //                              static u8 test_timeZone_Hour = 0;
 898   3      //                              
 899   3      //                              if(test_timeZone_Hour < 24)test_timeZone_Hour ++;
 900   3      //                              else{
 901   3      //                              
 902   3      //                                      test_timeZone_Hour = 0;
 903   3      //                              }
 904   3      //                              
 905   3      //                              heartBeat_Pack[8] = test_timeZone_Hour;
 906   3      //                              heartBeat_Pack[9] = 0;
 907   3      //                      }
 908   3                              
 909   3                              {
 910   4                              u16 integer_prt = (u16)elec_Consum & 0x00FF;    //µçÁ¿ÕûÊý²¿·Ö
 911   4                              u16 decimal_prt = (u16)((elec_Consum - (float)integer_prt) * 10000.0F); //µçÁ¿Ð¡Êý²¿·ÖÇ¿×ªÎªÕûÊýÀàÐÍ
 912   4                              
 913   4                              heartBeat_Pack[11]      = (u8)((integer_prt & 0x00FF) >> 0);    //ÕûÊý²¿·ÖÌî×°
 914   4                              heartBeat_Pack[12]      = (u8)((decimal_prt & 0xFF00) >> 8);    //Ð¡Êý²¿·ÖÌî×°
 915   4                              heartBeat_Pack[13]      = (u8)((decimal_prt & 0x00FF) >> 0);    //Ð¡Êý²¿·ÖÌî×°
C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 16  

 916   4                              }
 917   3                              
 918   3                              {
 919   4                              u16 integer_prt = (u16)paramElec_Param.ePower & 0xFFFF; //¹¦ÂÊÕûÊý²¿·Ö
 920   4                              u16 decimal_prt = (u16)((paramElec_Param.ePower - (float)integer_prt) * 10000.0F);      //¹¦ÂÊÐ¡Êý²¿·ÖÇ¿×ªÎª
             -ÕûÊýÀàÐÍ
 921   4                              
 922   4                              heartBeat_Pack[14]      = (u8)((integer_prt & 0xFF00) >> 8);    //ÕûÊý²¿·ÖÌî×°
 923   4                              heartBeat_Pack[15]      = (u8)((integer_prt & 0x00FF) >> 0);    //ÕûÊý²¿·ÖÌî×°
 924   4                              heartBeat_Pack[16]      = (u8)((decimal_prt & 0xFF00) >> 8);    //Ð¡Êý²¿·ÖÌî×°
 925   4                              heartBeat_Pack[17]      = (u8)((decimal_prt & 0x00FF) >> 0);    //Ð¡Êý²¿·ÖÌî×°
 926   4                              }
 927   3                              
 928   3                              heartBeat_Pack[18]      = elec_Consum_moment;   //¶ÔÓ¦Ê±¶Î±êÖ¾Ìî×°
 929   3                              
 930   3                      }else{  //Å¼ÊýÐÄÌø
 931   3                      
 932   3                              heartBeat_Type = !heartBeat_Type;
 933   3                              
 934   3                              heartBeat_Pack[2]       = FRAME_HEARTBEAT_cmdEven;
 935   3                              
 936   3                              heartBeat_Pack[9]       = deviceLock_flag;
 937   3                              heartBeat_Pack[10]      = ifTim_sw_running_FLAG;
 938   3                              heartBeat_Pack[11]      = status_Relay;
 939   3                              heartBeat_Pack[12]      = (ifDelay_sw_running_FLAG & 0x01) >> 0; //ÂÌÉ«Ä£Ê½
 940   3                      }
 941   2                      
 942   2                      heartBeat_Pack[19]      = SWITCH_TYPE_FP;
 943   2                      heartBeat_Pack[20]      = FRAME_TAIL_HEARTBEAT;
 944   2                      
 945   2      #if(SMARTSWITCH_IF != 1) //ÊÇ·ñÎªÀÏ°æAPP
 946   2                              memcpy(&heartBeat_Pack[3], &MAC_ID[1], 5);
 947   2                              memcpy(&heartBeat_Pack[8], &heartBeat_Pack[9], 12);
 948   2      #else
                                      memcpy(&heartBeat_Pack[3], &MAC_ID[0], 6);
              #endif
 951   2      
 952   2                      uartObjWIFI_Send_String(heartBeat_Pack, dataHeartBeatLength_objSERVER);
 953   2              }
 954   1              
 955   1              /*************************************±¾µØÍ¨Öª¿ª¹Ø×´Ì¬********************************************/
 956   1      #if(SMARTSWITCH_IF == 1)
                      if(swDataBroadcast_IF){
                              
                              swDataBroadcast_IF = 0;
                      
                              memset(repeatTX_buff, 0, sizeof(u8) * 45);
                              
                              repeatTX_buff[11] = (u8)status_Relay;
              
                              dtasTX_loadBasic_CUST( DATATRANS_objFLAG_MOBILE,
                                                                         repeatTX_buff,       /*·¢ËÍÇ°×îºó×°ÔØ*///·¢ËÍ°ü»ù±¾ÐÅÏ¢Ìî³ä
                                                                         FRAME_TYPE_StoM_RCVsuccess,
                                                                         FRAME_MtoSCMD_cmdControl,
                                                                         0
                                                                       );
                              uartObjWIFI_Send_String(repeatTX_buff, dataTransLength_objMOBILE);//Êý¾Ý½ÓÊÕ»Ø¸´ÏìÓ¦    
                      }
              #endif
 974   1      }


C51 COMPILER V9.54   DATATRANS                                                             09/20/2018 11:05:43 PAGE 17  

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2953    ----
   CONSTANT SIZE    =    240    ----
   XDATA SIZE       =    138     188
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      7       6
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)

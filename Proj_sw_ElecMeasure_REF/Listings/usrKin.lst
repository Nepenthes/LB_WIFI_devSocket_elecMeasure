C51 COMPILER V9.54   USRKIN                                                                09/07/2018 15:49:47 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE USRKIN
OBJECT MODULE PLACED IN .\Output\usrKin.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Usr\usrKin.c OMF2 ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Proj_s
                    -w_ElecMeasure;.\Usr;.\Usr_lib;.\std_Lib;.\hwDriver;.\dataTrans) DEBUG PRINT(.\Listings\usrKin.lst) OBJECT(.\Output\usrKi
                    -n.obj)

line level    source

   1          #include "usrKin.h"
   2          #include "Tips.h"
   3          
   4          #include "wifi_LPT220.h"
   5          #include "relay.h"
   6          
   7          #include "soft_uart.h"
   8          #include "delay.h"
   9          
  10          #include "stdio.h"
  11          #include "string.h"
  12          
  13          //*********************继电器驱动相关变量引用******************/
  14          extern status_ifSave    relayStatus_ifSave;
  15          extern bit                              status_Relay;
  16          
  17          /**********************本地文件变量定义区**********************/
  18          bit                     usrKeyCount_EN  = 0;
  19          u16     idata   usrKeyCount             = 0;
  20          
  21          void usrKin_pinInit(void){
  22   1              
  23   1              P2M1 &= ~(0x10);
  24   1              P2M0 &= ~(0x10);
  25   1      
  26   1      //      P2M1 |= 0x10;
  27   1      //      P2M0 &= ~(0x10);
  28   1              
  29   1      //      P2M1 |= 0x10;
  30   1      //      P2M0 |= 0x10;
  31   1      }
  32          
  33          bit UsrKEYScan_oneShoot(void){
  34   1      
  35   1              return Usr_key;
  36   1      }
  37          
  38          void UsrKEYScan(funKey_Callback funCB_Short, funKey_Callback funCB_LongA, funKey_Callback funCB_LongB){
  39   1              
  40   1              code    u16     keyCfrmLoop_Short       = 20,   //短按消抖时间
  41   1                                      keyCfrmLoop_LongA       = 8000, //长按A时间
  42   1                                      keyCfrmLoop_LongB       = 20000,//长按B时间
  43   1                                      keyCfrmLoop_MAX         = 60000;//计时封顶
  44   1              
  45   1              static  bit LongA_FLG = 0;
  46   1              static  bit LongB_FLG = 0;
  47   1              
  48   1              static  bit keyPress_FLG = 0;
  49   1      
  50   1              if(!UsrKEYScan_oneShoot()){     //选择提示
  51   2                      
  52   2                      keyPress_FLG = 1;
  53   2              
C51 COMPILER V9.54   USRKIN                                                                09/07/2018 15:49:47 PAGE 2   

  54   2                      if(!usrKeyCount_EN) usrKeyCount_EN= 1;  //计时
  55   2                      
  56   2                      if((usrKeyCount >= keyCfrmLoop_LongA) && (usrKeyCount <= keyCfrmLoop_LongB) && !LongA_FLG){
  57   3                              
  58   3                              funCB_LongA();
  59   3                              
  60   3                              LongA_FLG = 1;
  61   3                      }       
  62   2                      
  63   2                      if((usrKeyCount >= keyCfrmLoop_LongB) && (usrKeyCount <= keyCfrmLoop_MAX) && !LongB_FLG){
  64   3                              
  65   3                              funCB_LongB();
  66   3                              
  67   3                              LongB_FLG = 1;
  68   3                      }
  69   2                      
  70   2              }else{  //选择响应
  71   2                      
  72   2                      if(LongA_FLG || LongB_FLG)dev_ledTips = ledMode_relayOpenIF; //长按释放后led_tips恢复
  73   2                      
  74   2                      usrKeyCount_EN = 0;
  75   2                      
  76   2                      if(keyPress_FLG){
  77   3                      
  78   3                              keyPress_FLG = 0;
  79   3                              
  80   3                              if(usrKeyCount < keyCfrmLoop_LongA && usrKeyCount > keyCfrmLoop_Short)funCB_Short();
  81   3                              
  82   3                              usrKeyCount = 0;
  83   3                              LongA_FLG       = 0;
  84   3                              LongB_FLG       = 0;
  85   3                      }
  86   2              }
  87   1      }
  88          
  89          void fun_kLongA(void){
  90   1      
  91   1              dev_ledTips = ledMode_smartConfig;
  92   1              WIFI_hwSmartLink();
  93   1      }
  94          
  95          void fun_kLongB(void){
  96   1      
  97   1              dev_ledTips = ledMode_factory;
  98   1              WIFI_hwRestoreFactory();
  99   1      }
 100          
 101          void fun_kShort(void){
 102   1      
 103   1              relay_Act(relay_flip);
 104   1      }
 105          
 106          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    202    ----
   CONSTANT SIZE    =      8    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       9
   IDATA SIZE       =      2    ----
C51 COMPILER V9.54   USRKIN                                                                09/07/2018 15:49:47 PAGE 3   

   BIT SIZE         =      4    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
